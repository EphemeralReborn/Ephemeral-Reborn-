{"version":"1.0","source":"dHJ5X3JlcXVpcmUgPSBmdW5jdGlvbihtb2R1bGUsIG1lc3NhZ2UpDQoNCiAgICBsb2NhbCBzdWNjZXNzLCByZXN1bHQgPSBwY2FsbChyZXF1aXJlLCBtb2R1bGUpDQoNCiAgICBpZiBzdWNjZXNzIHRoZW4gDQogICAgICAgIHJldHVybiByZXN1bHQgDQogICAgZWxzZSANCiAgICAgICAgcmV0dXJuIGVycm9yKG1lc3NhZ2UpIA0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIGZmaSA9IHRyeV9yZXF1aXJlKCJmZmkiLCAiRkZJIGluaXRpYWxpemF0aW9uIGZhaWxlZCwgZW5zdXJlICdBbGxvdyB1bnNhZmUgc2NyaXB0cycgaXMgdGlja2VkIikNCmxvY2FsIGJpdCA9IHRyeV9yZXF1aXJlKCJiaXQiKQ0KbG9jYWwgdmVjdG9yID0gdHJ5X3JlcXVpcmUoInZlY3RvciIpDQpsb2NhbCBiYXNlNjQgPSB0cnlfcmVxdWlyZSgiZ2FtZXNlbnNlL2Jhc2U2NCIsICJEb3dubG9hZCBiYXNlNjQgbGliOiBodHRwczovL2dhbWVzZW5zZS5wdWIvZm9ydW1zL3ZpZXd0b3BpYy5waHA\/aWQ9MjE2MTkiKQ0KbG9jYWwgaHR0cCA9IHRyeV9yZXF1aXJlKCJnYW1lc2Vuc2UvaHR0cCIsICJEb3dubG9hZCBodHRwIGxpYjogaHR0cHM6Ly9nYW1lc2Vuc2UucHViL2ZvcnVtcy92aWV3dG9waWMucGhwP2lkPTIxNjE5IikNCmxvY2FsIGNsaXBib2FyZCA9IHRyeV9yZXF1aXJlKCJnYW1lc2Vuc2UvY2xpcGJvYXJkIiwgIkRvd25sb2FkIGNsaXBib2FyZCBsaWI6IGh0dHBzOi8vZ2FtZXNlbnNlLnB1Yi9mb3J1bXMvdmlld3RvcGljLnBocD9pZD0yODY3OCIpDQoNCmxvY2FsIGFuZ2xlM2Rfc3RydWN0ID0gZmZpLnR5cGVvZigic3RydWN0IHsgZmxvYXQgcGl0Y2g7IGZsb2F0IHlhdzsgZmxvYXQgcm9sbDsgfSIpDQpsb2NhbCB2ZWNfc3RydWN0ID0gZmZpLnR5cGVvZigic3RydWN0IHsgZmxvYXQgeDsgZmxvYXQgeTsgZmxvYXQgejsgfSIpDQoNCmxvY2FsIFVzZXJDTURfc3RydWN0ID0NCiAgICBmZmkudHlwZW9mKA0KICAgIFtbDQogICAgc3RydWN0DQogICAgew0KICAgICAgICB1aW50cHRyX3QgdmZwdHI7DQogICAgICAgIGludCBjb21tYW5kX251bWJlcjsNCiAgICAgICAgaW50IHRpY2tfY291bnQ7DQogICAgICAgICQgdmlld2FuZ2xlczsNCiAgICAgICAgJCBhaW1kaXJlY3Rpb247DQogICAgICAgIGZsb2F0IGZvcndhcmRtb3ZlOw0KICAgICAgICBmbG9hdCBzaWRlbW92ZTsNCiAgICAgICAgZmxvYXQgdXBtb3ZlOw0KICAgICAgICBpbnQgYnV0dG9uczsNCiAgICAgICAgdWludDhfdCBpbXB1bHNlOw0KICAgICAgICBpbnQgd2VhcG9uc2VsZWN0Ow0KICAgICAgICBpbnQgd2VhcG9uc3VidHlwZTsNCiAgICAgICAgaW50IHJhbmRvbV9zZWVkOw0KICAgICAgICBzaG9ydCBtb3VzZWR4Ow0KICAgICAgICBzaG9ydCBtb3VzZWR5Ow0KICAgICAgICBib29sIGhhc2JlZW5wcmVkaWN0ZWQ7DQogICAgICAgICQgaGVhZGFuZ2xlczsNCiAgICAgICAgJCBoZWFkb2Zmc2V0Ow0KICAgICAgICBib29sIHNlbmRfcGFja2V0OyANCiAgICB9DQogICAgXV0sDQogICAgYW5nbGUzZF9zdHJ1Y3QsDQogICAgdmVjX3N0cnVjdCwNCiAgICBhbmdsZTNkX3N0cnVjdCwNCiAgICB2ZWNfc3RydWN0DQopDQoNCmxvY2FsIGNsaWVudF9zaWcgPSBjbGllbnQuZmluZF9zaWduYXR1cmUoImNsaWVudC5kbGwiLCAiXHhCOVx4Q0NceENDXHhDQ1x4Q0NceDhCXHg0MFx4MzhceEZGXHhEMFx4ODRceEMwXHgwRlx4ODUiKSBvciBlcnJvcigiQ291bGRuJ3QgZmluZCBzaWduYXR1cmUhIikNCmxvY2FsIGdldF9Vc2VyQ01EX3N0cnVjdCA9IGZmaS50eXBlb2YoIiQqIChfX3RoaXNjYWxsKikodWludHB0cl90IGVjeCwgaW50IG5TbG90LCBpbnQgc2VxdWVuY2VfbnVtYmVyKSIsIFVzZXJDTURfc3RydWN0KQ0KbG9jYWwgaW5wdXRfdnRibCA9IGZmaS50eXBlb2YoW1tzdHJ1Y3R7dWludHB0cl90IHBhZGRpbmdbOF07ICQgR2V0VXNlckNtZDt9XV0sIGdldF9Vc2VyQ01EX3N0cnVjdCkNCmxvY2FsIGlucHV0X3ZmdW5jX3B0ciAgPSBmZmkudHlwZW9mKFtbc3RydWN0IHsgJCogdmZwdHI7IH0qXV0sIGlucHV0X3Z0YmwpDQpsb2NhbCBnZXRfaW5wdXRfdmZ1bmNfcHRyID0gZmZpLmNhc3QoaW5wdXRfdmZ1bmNfcHRyICwgZmZpLmNhc3QoInVpbnRwdHJfdCoqIiwgdG9udW1iZXIoZmZpLmNhc3QoInVpbnRwdHJfdCIsIGNsaWVudF9zaWcpKSArIDEpWzBdKQ0KDQpsb2NhbCBwcmVzZXRzID0ge30NCg0KbG9jYWwgcmVmcyA9IHsNCiAgICBkYW1hZ2Vfb3ZlcnJpZGUgPSB7dWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSBvdmVycmlkZSIpfSwNCiAgICBkYW1hZ2UgPSB7dWkucmVmZXJlbmNlKCJSQUdFIiwgIkFpbWJvdCIsICJNaW5pbXVtIGRhbWFnZSIpfSwNCiAgICBkZWxheV9zaG90ID0gdWkucmVmZXJlbmNlKCJSQUdFIiwgIk90aGVyIiwgIkRlbGF5IHNob3QiKSwNCiAgICBmYWtlZHVjayA9IHVpLnJlZmVyZW5jZSgiUkFHRSIsICJPdGhlciIsICJEdWNrIHBlZWsgYXNzaXN0IiksDQogICAgZG91YmxldGFwID0ge3VpLnJlZmVyZW5jZSgiUkFHRSIsICJBaW1ib3QiLCAiRG91YmxlIHRhcCIpfSwNCiAgICBlbmFibGVkID0gdWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRW5hYmxlZCIpLA0KICAgIHBpdGNoID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgInBpdGNoIil9LA0KICAgIHJvbGwgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJyb2xsIiksDQogICAgeWF3X2Jhc2UgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXcgYmFzZSIpLA0KICAgIHlhdyA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJZYXciKX0sDQogICAgZnJlZXN0YW5kaW5nX2JvZHl5YXcgPSB1aS5yZWZlcmVuY2UoIkFBIiwgImFudGktYWltYm90IGFuZ2xlcyIsICJGcmVlc3RhbmRpbmcgYm9keSB5YXciKSwNCiAgICBlZGdlX3lhdyA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIkVkZ2UgeWF3IiksDQogICAgeWF3aml0dGVyID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiQW50aS1haW1ib3QgYW5nbGVzIiwgIllhdyBqaXR0ZXIiKX0sDQogICAgYm9keXlhdyA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJCb2R5IHlhdyIpfSwNCiAgICBmcmVlc3RhbmRpbmcgPSB7dWkucmVmZXJlbmNlKCJBQSIsICJBbnRpLWFpbWJvdCBhbmdsZXMiLCAiRnJlZXN0YW5kaW5nIil9LA0KICAgIGZha2VsYWdfZW5hYmxlZCA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIkVuYWJsZWQiKX0sDQogICAgZmFrZWxhZ19tb2RlID0gdWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJBbW91bnQiKSwNCiAgICBmYWtlbGFnX3ZhcmlhbmNlID0gdWkucmVmZXJlbmNlKCJBQSIsICJGYWtlIGxhZyIsICJWYXJpYW5jZSIpLA0KICAgIGZha2VsYWdfbGltaXQgPSB1aS5yZWZlcmVuY2UoIkFBIiwgIkZha2UgbGFnIiwgIkxpbWl0IiksDQogICAgb25zaG90ID0ge3VpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiT24gc2hvdCBhbnRpLWFpbSIpfSwNCiAgICBzbG93X21vdGlvbiA9IHt1aS5yZWZlcmVuY2UoIkFBIiwgIk90aGVyIiwgIlNsb3cgbW90aW9uIil9LA0KICAgIGxlZ19tb3ZlbWVudCA9IHVpLnJlZmVyZW5jZSgiQUEiLCAiT3RoZXIiLCAiTGVnIG1vdmVtZW50IiksDQogICAgcXVpY2tfcGVlayA9IHt1aS5yZWZlcmVuY2UoIlJBR0UiLCAiT3RoZXIiLCAiUXVpY2sgcGVlayBhc3Npc3QiKX0sDQp9DQoNCmxvY2FsIGx1YSA9IHsNCiAgICBkYXRhYmFzZSA9IHsNCiAgICAgICAgY29uZmlncyA9ICI6RXBoZW1lcmFsOjpjb25maWdzOiINCiAgICB9LA0KICAgIHZhcnMgPSB7DQogICAgICAgIGhpdGdyb3VwX25hbWVzID0geyAiR2VuZXJpYyIsICJIZWFkIiwgIkNoZXN0IiwgIlN0b21hY2giLCAiTGVmdCBhcm0iLCAiUmlnaHQgYXJtIiwgIkxlZnQgbGVnIiwgIlJpZ2h0IGxlZyIsICJOZWNrIiwgIj8iLCAiR2VhciIgfSwNCiAgICAgICAgcGxheWVyX3N0YXRlcyA9IHsiR2xvYmFsIiwgIlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93d2Fsa2luZyIsICJDcm91Y2hpbmciLCAiQWlyIiwgIkFpci1Dcm91Y2hpbmciLCAiQ3JvdWNoLU1vdmluZyIsICJGYWtlbGFnIn0sDQogICAgICAgIHBsYXllcl9zdGF0ZXNfYWJyZXYgPSB7IkciLCAiUyIsICJNIiwgIlNXIiwgIkMiLCAiQSIsICJBQyIsICJDTSIsICJGTCJ9LA0KICAgICAgICBzdHJpbmdfdG9faW50ID0ge1siR2xvYmFsIl0gPSAxLCBbIlN0YW5kaW5nIl0gPSAyLCBbIk1vdmluZyJdID0gMywgWyJTbG93d2Fsa2luZyJdID0gNCwgWyJDcm91Y2hpbmciXSA9IDUsIFsiQWlyIl0gPSA2LCBbIkFpci1Dcm91Y2hpbmciXSA9IDcsIFsiQ3JvdWNoLU1vdmluZyJdID0gOCAsIFsiRmFrZWxhZyJdID0gOX0sDQogICAgICAgIGludF90b19zdHJpbmcgPSB7WzFdID0gIkdsb2JhbCIsIFsyXSA9ICJTdGFuZGluZyIsIFszXSA9ICJNb3ZpbmciLCBbNF0gPSAiU2xvd3dhbGtpbmciLCBbNV0gPSAiQ3JvdWNoaW5nIiwgWzZdID0gIkFpciIsIFs3XSA9ICJBaXItQ3JvdWNoaW5nIiwgWzhdID0gIkNyb3VjaC1Nb3ZpbmciLCBbOV0gPSAiRmFrZWxhZyJ9LA0KICAgICAgICBhY3RpdmVfc3RhdGUgPSAxLA0KICAgICAgICBwbGF5ZXJfc3RhdGUgPSAxLA0KICAgIH0sDQogICAgZnVuY3MgPSB7DQogICAgICAgIHRhYmxlX2NvbnRhaW5zID0gZnVuY3Rpb24odGJsLCB2YWx1ZSkNCiAgICAgICAgICAgIGZvciBpID0gMSwgI3RibCBkbw0KICAgICAgICAgICAgICAgIGlmIHRibFtpXSA9PSB2YWx1ZSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHJldHVybiB0cnVlDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICBlbmQsDQogICAgICAgIHJlc2V0X2FudGlhaW1fdGFiID0gZnVuY3Rpb24ocmVmKQ0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5lbmFibGVkLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnBpdGNoWzFdLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnBpdGNoWzJdLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnJvbGwsIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3X2Jhc2UsIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3WzFdLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLnlhd1syXSwgcmVmKQ0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy55YXdqaXR0ZXJbMV0sIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMueWF3aml0dGVyWzJdLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmJvZHl5YXdbMV0sIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuYm9keXlhd1syXSwgcmVmKQ0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5mcmVlc3RhbmRpbmdbMV0sIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZnJlZXN0YW5kaW5nWzJdLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmZyZWVzdGFuZGluZ19ib2R5eWF3LCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmVkZ2VfeWF3LCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmZha2VsYWdfZW5hYmxlZFsxXSwgcmVmKQ0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5mYWtlbGFnX2VuYWJsZWRbMl0sIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZmFrZWxhZ19tb2RlLCByZWYpDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmZha2VsYWdfdmFyaWFuY2UsIHJlZikNCiAgICAgICAgICAgIHVpLnNldF92aXNpYmxlKHJlZnMuZmFrZWxhZ19saW1pdCwgcmVmKQ0KICAgICAgICBlbmQsDQogICAgICAgIGRlZmF1bHRfYW50aWFpbV90YWIgPSBmdW5jdGlvbigpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5lbmFibGVkLCB0cnVlKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmcy5yb2xsLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3X2Jhc2UsICJsb2NhbCB2aWV3IikNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keXlhd1sxXSwgIk9mZiIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5eWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZnJlZXN0YW5kaW5nWzFdLCBmYWxzZSkNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZyZWVzdGFuZGluZ1syXSwgIk9uIGhvdGtleSIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mcmVlc3RhbmRpbmdfYm9keXlhdywgZmFsc2UpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5lZGdlX3lhdywgZmFsc2UpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mYWtlbGFnX2VuYWJsZWRbMV0sIHRydWUpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mYWtlbGFnX2VuYWJsZWRbMl0sICJBbHdheXMgT24iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZmFrZWxhZ19tb2RlLCAiTWF4aW11bSIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mYWtlbGFnX3ZhcmlhbmNlLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZmFrZWxhZ19saW1pdCwgMTQpDQogICAgICAgIGVuZCwNCiAgICAgICAgbm9ybWFsaXplID0gZnVuY3Rpb24oYW5nbGUpDQogICAgICAgICAgICByZXR1cm4gKGFuZ2xlICsgMTgwKSAlIDM2MCAtIDE4MA0KICAgICAgICBlbmQsDQogICAgICAgIHZlY19hbmdsZXMgPSBmdW5jdGlvbihhbmdsZV94LCBhbmdsZV95KQ0KICAgICAgICAgICAgcmFkX2FuZ2xlX3ggPSBtYXRoLnJhZChhbmdsZV94KQ0KICAgICAgICAgICAgcmFkX2FuZ2xlX3kgPSBtYXRoLnJhZChhbmdsZV95KQ0KICAgICAgICAgICAgc3kgPSBtYXRoLnNpbihyYWRfYW5nbGVfeSkNCiAgICAgICAgICAgIGN5ID0gbWF0aC5jb3MocmFkX2FuZ2xlX3kpDQogICAgICAgICAgICBzcCA9IG1hdGguc2luKHJhZF9hbmdsZV94KQ0KICAgICAgICAgICAgY3AgPSBtYXRoLmNvcyhyYWRfYW5nbGVfeCkNCiAgICAgICAgICAgIHJldHVybiBjcCAqIGN5LCBjcCAqIHN5LCAtc3ANCiAgICAgICAgZW5kLA0KICAgICAgICBoZXggPSBmdW5jdGlvbihhcmcpDQogICAgICAgICAgICByZXN1bHQgPSAiXGEiDQogICAgICAgICAgICBmb3IgXywgdmFsdWUgaW4gcGFpcnMoYXJnKSBkbw0KICAgICAgICAgICAgICAgIG91dHB1dCA9IHN0cmluZy5mb3JtYXQoIiUwMlgiLCB2YWx1ZSkNCiAgICAgICAgICAgICAgICByZXN1bHQgPSByZXN1bHQgLi4gb3V0cHV0DQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHJldHVybiByZXN1bHQgLi4gIkZGIg0KICAgICAgICBlbmQsDQogICAgICAgIHJnYmFfaGV4ID0gZnVuY3Rpb24ociwgZywgYiwgYSkNCiAgICAgICAgICAgIHJldHVybiBzdHJpbmcuZm9ybWF0KCIlMDJYJTAyWCUwMlglMDJYIiwgciwgZywgYiwgYSkNCiAgICAgICAgZW5kLA0KICAgICAgICBjcmVhdGVfY29sb3JfYXJyYXkgPSBmdW5jdGlvbihyLCBnLCBiLCBzdHIpDQogICAgICAgICAgICBsb2NhbCBjb2xvcnMgPSB7fQ0KICAgICAgICAgICAgbG9jYWwgY3VydGltZSA9IGdsb2JhbHMuY3VydGltZSgpDQogICAgICAgICAgICBsb2NhbCBjb3NfYmFzZSA9IDIgKiBtYXRoLnBpICogY3VydGltZSAvIDQNCiAgICAgICAgDQogICAgICAgICAgICBmb3IgaSA9IDAsICNzdHIgZG8NCiAgICAgICAgICAgICAgICBsb2NhbCBhbHBoYSA9IDI1NSAqIG1hdGguYWJzKG1hdGguY29zKGNvc19iYXNlICsgaSAqIDUgLyAzMCkpDQogICAgICAgICAgICAgICAgY29sb3JzWyNjb2xvcnMgKyAxXSA9IHtyLCBnLCBiLCBhbHBoYX0NCiAgICAgICAgICAgIGVuZA0KICAgICAgICANCiAgICAgICAgICAgIHJldHVybiBjb2xvcnMNCiAgICAgICAgZW5kLA0KICAgIH0NCn0NCg0KbG9jYWwgbWVudV9jb2xvcl9yZWYgPSB1aS5yZWZlcmVuY2UoIk1JU0MiLCAiU2V0dGluZ3MiLCAiTWVudSBjb2xvciIpDQpsb2NhbCBsdWFfY29sb3IgPSB7dWkuZ2V0KG1lbnVfY29sb3JfcmVmKX0NCg0KY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiV2VsY29tZSB0b1wwIikNCmNsaWVudC5jb2xvcl9sb2cobHVhX2NvbG9yWzFdLCBsdWFfY29sb3JbMl0sIGx1YV9jb2xvclszXSwgIiBFcGhlbWVyYWxcMCIpDQpjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICIgW1JlYm9ybl0iKQ0KDQpsb2NhbCB0YWIsIGNvbnRhaW5lcl9hYSwgY29udGFpbmVyX2ZsID0gIkFBIiwgIkFudGktYWltYm90IGFuZ2xlcyIsICJGYWtlIGxhZyINCmxvY2FsIGxhYmVsID0gdWkubmV3X2xhYmVsKHRhYiwgY29udGFpbmVyX2FhLCAiRXBoZW1lcmFsIikNCmxvY2FsIHRhYl9zZWxlY3Rpb24gPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJcblRhYiIsICJBbnRpLWFpbSIsICJNaXNjIiwgIkNvbmZpZyIpDQpsb2NhbCBhbnRpYWltX3RhYnMgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJcbkFudGktYWltIFRhYnMiLCAiQnVpbGRlciIsICJLZXliaW5kcyIpDQoNCmxvY2FsIG1lbnUgPSB7DQogICAgYW50aWFpbV90YWIgPSB7DQogICAgICAgIHNhZmV0eV9vcHRpb25zID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyX2FhLCAiU2FmZXR5IG9wdGlvbnMiLCAiUmFuZG9tIGFudGktYWltIiwgIlNhZmUga25pZmUiLCAiU2FmZSBoZWFkIiwgIlN0YXRpYyBvbiBoZWlnaHQgYWR2YW50YWdlIiwgIkF2b2lkIGJhY2tzdGFiIiksDQogICAgICAgIHJhbmRvbV9hbnRpYWltX2NvbmRpdGlvbnMgPSB1aS5uZXdfbXVsdGlzZWxlY3QodGFiLCBjb250YWluZXJfYWEsICJSYW5kb20gYW50aS1haW0gY29uZGl0aW9ucyIsICJXYXJtdXAiLCAiRnJlZXplIHRpbWUiLCAiUm91bmQgZW5kIiksDQogICAgICAgIHNhZmVfaGVhZF9zdGF0ZXMgPSB1aS5uZXdfbXVsdGlzZWxlY3QodGFiLCBjb250YWluZXJfYWEsICJTYWZlIGhlYWQgc3RhdGVzIiwgIlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93d2Fsa2luZyIsICJDcm91Y2hpbmciLCAiQWlyIiwgIkFpci1Dcm91Y2hpbmciLCAiQ3JvdWNoLU1vdmluZyIsICJPbiBaZXVzIiksDQogICAgICAgIHN0YXRpY19vbl9oZWlnaHRfc3RhdGVzID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyX2FhLCAiU3RhdGljIG9uIGhlaWdodCBhZHZhbnRhZ2Ugc3RhdGVzIiwgIlN0YW5kaW5nIiwgIk1vdmluZyIsICJTbG93d2Fsa2luZyIsICJDcm91Y2hpbmciLCAiQWlyIiwgIkFpci1Dcm91Y2hpbmciLCAiQ3JvdWNoLU1vdmluZyIpLA0KICAgICAgICBvbnVzZV9hbnRpYWltX21vZGUgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJPbi11c2UgQW50aWFpbSIsICJTdGF0aWMiLCAiSml0dGVyIiksDQogICAgICAgIG9udXNlX2FudGlhaW1faG90a2V5ID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lcl9hYSwgIk9uLXVzZSBrZXliaW5kIiwgdHJ1ZSksDQogICAgICAgIG9udXNlX2FudGlhaW1fc2lkZSA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lcl9hYSwgIkRlc3luYyBzaWRlIiwgIkxlZnQiLCAiUmlnaHQiKSwNCiAgICAgICAgZnJlZXN0YW5kX21vZGUgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJGcmVlc3RhbmRpbmciLCAiSml0dGVyIiwgIlN0YXRpYyIpLA0KICAgICAgICBmcmVlc3RhbmRfaG90a2V5ID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lcl9hYSwgIkZyZWVzdGFuZCIsIHRydWUpLA0KICAgICAgICBmcmVlc3RhbmRfZGlzYWJsZXJzID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyX2FhLCAiRnJlZXN0YW5kIERpc2FibGVycyIsIGx1YS52YXJzLnBsYXllcl9zdGF0ZXMpLA0KICAgICAgICBmYXN0X2xhZGRlciA9IHVpLm5ld19jaGVja2JveCh0YWIsIGNvbnRhaW5lcl9hYSwgIkZhc3QgbGFkZGVyIiksDQogICAgICAgIGVkZ2VfeWF3ID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lcl9hYSwgIkVkZ2UgeWF3IiwgZmFsc2UpLA0KICAgICAgICBtYW51YWxfYW50aWFpbV9mb3J3YXJkID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lcl9hYSwgIk1hbnVhbCBGb3J3YXJkIiwgZmFsc2UpLA0KICAgICAgICBtYW51YWxfYW50aWFpbV9sZWZ0ID0gdWkubmV3X2hvdGtleSh0YWIsIGNvbnRhaW5lcl9hYSwgIk1hbnVhbCBMZWZ0IiwgZmFsc2UpLA0KICAgICAgICBtYW51YWxfYW50aWFpbV9yaWdodCA9IHVpLm5ld19ob3RrZXkodGFiLCBjb250YWluZXJfYWEsICJNYW51YWwgUmlnaHQiLCBmYWxzZSksDQogICAgfSwNCiAgICBhbnRpYWltX2J1aWxkZXJfdGFiID0gew0KICAgICAgICBzdGF0ZSA9IHVpLm5ld19jb21ib2JveCh0YWIsIGNvbnRhaW5lcl9hYSwgIkFudGktYWltIHN0YXRlIiwgbHVhLnZhcnMucGxheWVyX3N0YXRlcykNCiAgICB9LA0KICAgIG1pc2NfdGFiID0gew0KICAgICAgICBhbmltYXRpb25zID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyX2FhLCAiQW5pbSBicmVha2VycyIsICJTdGF0aWMgbGVncyIsICJMZWcgZnVja2VyIiwgIjAgcGl0Y2ggb24gbGFuZGluZyIpLA0KICAgICAgICBtaW5pbXVtX2RhbWFnZV9pbmRpY2F0b3IgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJNaW5pbXVtIERhbWFnZSBJbmRpY2F0b3IiLCAiT2ZmIiwgIk9uIG92ZXJyaWRlIiwgIkFsd2F5cyIpLA0KICAgIH0sDQoNCiAgICBjb25maWd1cmF0aW9uX3RhYiA9IHsNCiAgICAgICAgbGlzdCA9IHVpLm5ld19saXN0Ym94KHRhYiwgY29udGFpbmVyX2FhLCAiQ29uZmlncyIsICIiKSwNCiAgICAgICAgbmFtZSA9IHVpLm5ld190ZXh0Ym94KHRhYiwgY29udGFpbmVyX2FhLCAiQ29uZmlnIG5hbWUiLCAiIiksDQogICAgICAgIGxvYWQgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyX2FhLCAiTG9hZCIsIGZ1bmN0aW9uKCkgZW5kKSwNCiAgICAgICAgc2F2ZSA9IHVpLm5ld19idXR0b24odGFiLCBjb250YWluZXJfYWEsICJTYXZlIiwgZnVuY3Rpb24oKSBlbmQpLA0KICAgICAgICBkZWxldGUgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyX2FhLCAiRGVsZXRlIiwgZnVuY3Rpb24oKSBlbmQpLA0KICAgICAgICBpbXBvcnQgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyX2FhLCAiSW1wb3J0IiwgZnVuY3Rpb24oKSBlbmQpLA0KICAgICAgICBleHBvcnQgPSB1aS5uZXdfYnV0dG9uKHRhYiwgY29udGFpbmVyX2FhLCAiRXhwb3J0IiwgZnVuY3Rpb24oKSBlbmQpDQogICAgfQ0KfQ0KDQpsb2NhbCBhbnRpYWltX2J1aWxkZXJfdGJsID0ge30NCmxvY2FsIGFudGlhaW1fY29udGFpbmVyID0ge30NCmZvciBpPTEsICNsdWEudmFycy5wbGF5ZXJfc3RhdGVzIGRvDQogICAgYW50aWFpbV9jb250YWluZXJbaV0gPSBsdWEuZnVuY3MuaGV4KHsyMDAsMjAwLDIwMH0pIC4uICIoIiAuLiBsdWEuZnVuY3MuaGV4KHsyMjIsNTUsNTV9KSAuLiAiIiAuLiBsdWEudmFycy5wbGF5ZXJfc3RhdGVzX2FicmV2W2ldIC4uICIiIC4uIGx1YS5mdW5jcy5oZXgoezIwMCwyMDAsMjAwfSkgLi4gIikiIC4uIGx1YS5mdW5jcy5oZXgoezE1NSwxNTUsMTU1fSkgLi4gIiAiDQogICAgYW50aWFpbV9idWlsZGVyX3RibFtpXSA9IHsNCiAgICAgICAgZW5hYmxlX3N0YXRlID0gdWkubmV3X2NoZWNrYm94KHRhYiwgY29udGFpbmVyX2FhLCAiRW5hYmxlIHN0YXRlOiAiIC4uIGx1YS5mdW5jcy5oZXgoe2x1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM119KSAuLiBsdWEudmFycy5wbGF5ZXJfc3RhdGVzW2ldKSwNCiAgICAgICAgc3RhdGVfZGlzYWJsZXJzID0gdWkubmV3X211bHRpc2VsZWN0KHRhYiwgY29udGFpbmVyX2FhLCAiRGlzYWJsZXJzXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAiU3RhbmRpbmciLCAiTW92aW5nIiwgIlNsb3d3YWxraW5nIiwgIkNyb3VjaGluZyIsICJBaXIiLCAiQWlyLUNyb3VjaGluZyIsICJDcm91Y2gtTW92aW5nIiksDQogICAgICAgIHBpdGNoID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyX2FhLCAiUGl0Y2hcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sICJPZmYiLCAiRGVmYXVsdCIsICJVcCIsICJEb3duIiwgIk1pbmltYWwiLCAiUmFuZG9tIiwgIkN1c3RvbSIpLA0KICAgICAgICBwaXRjaF9zbGlkZXIgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiXG5QaXRjaCBhZGQiIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAtODksIDg5LCAwLCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgeWF3X2Jhc2UgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJZYXcgYmFzZVxuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgIkxvY2FsIHZpZXciLCAiQXQgdGFyZ2V0cyIpLA0KICAgICAgICB5YXcgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJZYXdcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sICJPZmYiLCAiU3RhdGljIiwgIkwmUiIpLA0KICAgICAgICB5YXdfc3RhdGljID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9hYSwgIlxueWF3IiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgeWF3X2xlZnQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiTGVmdFxueWF3IiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgLTE4MCwgMTgwLCAwLCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgeWF3X3JpZ2h0ID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9hYSwgIlJpZ2h0XG55YXciIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAtMTgwLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICB5YXdqaXR0ZXIgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJZYXcgaml0dGVyXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAiT2ZmIiwgIlJhbmRvbSIpLA0KICAgICAgICB5YXdqaXR0ZXJfcmFuZG9tID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9hYSwgIlxueWF3IGppdHRlciIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksDQogICAgICAgIGJvZHl5YXcgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJCb2R5IHlhd1xuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgIk9mZiIsICJTdGF0aWMiLCAiSml0dGVyIiwgIkRlbGF5ZWQgSml0dGVyIiksDQogICAgICAgIGZha2VfbGltaXQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiRmFrZSB5YXcgbGltaXRcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC01OCwgNTgsIDAsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICBmYWtlX2xpbWl0X2xlZnQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiRmFrZSB5YXcgbGVmdFxuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgMSwgNTgsIDI1LCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgZmFrZV9saW1pdF9yaWdodCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXJfYWEsICJGYWtlIHlhdyByaWdodFxuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgMSwgNTgsIDI1LCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgZmFrZV9saW1pdF9sZWZ0X2RlbGF5ZWQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiRmFrZSB5YXcgbGVmdFxuIGRlbGF5ZWQiIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAxLCA1OCwgMjUsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICBmYWtlX2xpbWl0X3JpZ2h0X2RlbGF5ZWQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2FhLCAiRmFrZSB5YXcgcmlnaHRcbiBkZWxheWVkIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgMSwgNTgsIDI1LCB0cnVlLCAiwrAiLCAxKSwNCiAgICAgICAgZmFrZV9saW1pdF9kZWxheV90aWNrcyA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXJfYWEsICJEZWxheSB0aWNrc1xuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgMSwgMTAsIDEsIHRydWUsICIiLCAxKSwNCiAgICAgICAgZm9yY2VfZGVmZW5zaXZlX2V4cGxvaXQgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfYWEsICJGb3JjZSBkZWZlbnNpdmVcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sICJPbi1wZWVrIiwgIkFsd2F5cyBvbiIsICJDb21tYW5kIGJhc2VkIiksDQogICAgICAgIGRlZmVuc2l2ZV9hbnRpYWltX3NlbGVjdGlvbiA9IHVpLm5ld19tdWx0aXNlbGVjdCh0YWIsIGNvbnRhaW5lcl9mbCwgIkRlZmVuc2l2ZSBhbnRpYWltXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAiUGl0Y2giLCAiWWF3IiksDQogICAgICAgIGRlZmVuc2l2ZV9waXRjaF9vcHRpb25zID0gdWkubmV3X2NvbWJvYm94KHRhYiwgY29udGFpbmVyX2ZsLCAiRGVmZW5zaXZlIHBpdGNoXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAiVXAiLCAiSGFsZi11cCIsICJaZXJvIiwgIkZsaWNrIiwgIlJhbmRvbSIsICJDdXN0b20iKSwNCiAgICAgICAgZGVmZW5zaXZlX3BpdGNoX2ZsaWNrX2RlZ3JlZTEgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2ZsLCAiRmxpY2sgZGVncmVlIFsxXVxuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgLTg5LCA4OSwgMCwgdHJ1ZSwgIsKwIiwgMSksDQogICAgICAgIGRlZmVuc2l2ZV9waXRjaF9mbGlja19kZWdyZWUyID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9mbCwgIkZsaWNrIGRlZ3JlZSBbMl1cbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC04OSwgODksIDAsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICBkZWZlbnNpdmVfcGl0Y2hfY3VzdG9tID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9mbCwgIkN1c3RvbSBkZWdyZWVcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC04OSwgODksIDAsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICBkZWZlbnNpdmVfeWF3X29wdGlvbnMgPSB1aS5uZXdfY29tYm9ib3godGFiLCBjb250YWluZXJfZmwsICJEZWZlbnNpdmUgeWF3XG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAiRm9yd2FyZCIsICJGbGljayIsICJTcGluIiwgIkRpc3RvcnRpb24iLCAiUmFuZG9tIiksDQogICAgICAgIGRlZmVuc2l2ZV95YXdfZmxpY2tfYW5nbGUxID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9mbCwgIkZsaWNrIGRlZ3JlZSBbMV1cbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksDQogICAgICAgIGRlZmVuc2l2ZV95YXdfZmxpY2tfYW5nbGUyID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9mbCwgIkZsaWNrIGRlZ3JlZSBbMl1cbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIC0xODAsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksDQogICAgICAgIGRlZmVuc2l2ZV95YXdfc3Bpbl9yYW5nZSA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXJfZmwsICJTcGluIHJhbmdlXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAxLCAxODAsIDAsIHRydWUsICLCsCIsIDEpLA0KICAgICAgICBkZWZlbnNpdmVfeWF3X3NwaW5fc3BlZWQgPSB1aS5uZXdfc2xpZGVyKHRhYiwgY29udGFpbmVyX2ZsLCAiU3BpbiBzcGVlZFxuIiAuLiBhbnRpYWltX2NvbnRhaW5lcltpXSwgMSwgMTAsIDEsIHRydWUsICIiLCAxKSwNCiAgICAgICAgZGVmZW5zaXZlX3lhd19kaXN0b3J0aW9uX3JhbmdlID0gdWkubmV3X3NsaWRlcih0YWIsIGNvbnRhaW5lcl9mbCwgIkRpc3RvcnRpb24gcmFuZ2VcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIDEsIDE4MCwgMCwgdHJ1ZSwgIsKwIiwgMSksDQogICAgICAgIGRlZmVuc2l2ZV95YXdfZGlzdG9ydGlvbl9zcGVlZCA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXJfZmwsICJEaXN0b3J0aW9uIHNwZWVkXG4iIC4uIGFudGlhaW1fY29udGFpbmVyW2ldLCAxLCAxMCwgMSwgdHJ1ZSwgIiIsIDEpLA0KICAgICAgICBkZWZlbnNpdmVfeWF3X3JhbmRvbV9yYW5nZSA9IHVpLm5ld19zbGlkZXIodGFiLCBjb250YWluZXJfZmwsICJSYW5kb20gUmFuZ2VcbiIgLi4gYW50aWFpbV9jb250YWluZXJbaV0sIDEsIDM2MCwgMSwgdHJ1ZSwgIsKwIiwgMSksDQogICAgfQ0KZW5kDQoNCmNvbmZpZ19zeXN0ZW0gPSB7fQ0KDQpjb25maWdfc3lzdGVtID0gew0KDQogICAgZ2V0X2NvbmZpZyA9IGZ1bmN0aW9uKG5hbWUpDQogICAgICAgIGxvY2FsIGRhdGFiYXNlID0gZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykgb3Ige30NCg0KICAgICAgICBmb3IgaSwgdiBpbiBwYWlycyhkYXRhYmFzZSkgZG8NCiAgICAgICAgICAgIGlmIHYubmFtZSA9PSBuYW1lIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gew0KICAgICAgICAgICAgICAgICAgICBjb25maWcgPSB2LmNvbmZpZywNCiAgICAgICAgICAgICAgICAgICAgaW5kZXggPSBpDQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KDQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKHByZXNldHMpIGRvDQogICAgICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZSB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIHsNCiAgICAgICAgICAgICAgICAgICAgY29uZmlnID0gdi5jb25maWcsDQogICAgICAgICAgICAgICAgICAgIGluZGV4ID0gaQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICByZXR1cm4gZmFsc2UNCiAgICBlbmQsDQogICAgc2F2ZV9jb25maWcgPSBmdW5jdGlvbihuYW1lKQ0KICAgICAgICBsb2NhbCBkYiA9IGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpIG9yIHt9DQogICAgICAgIGxvY2FsIGNvbmZpZ190YmwgPSB7DQogICAgICAgICAgICBhbnRpYWltID0ge30sDQogICAgICAgICAgICBhbnRpYWltX3RhYiA9IHt9DQogICAgICAgIH0NCiAgICANCiAgICAgICAgaWYgbmFtZTptYXRjaCgiW14ld10iKSB0aGVuDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZW5kDQogICAgDQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKGx1YS52YXJzLnBsYXllcl9zdGF0ZXNfYWJyZXYpIGRvDQogICAgICAgICAgICBjb25maWdfdGJsLmFudGlhaW1bdmFsdWVdID0ge30NCiAgICAgICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGFudGlhaW1fYnVpbGRlcl90Ymxba2V5XSkgZG8NCiAgICAgICAgICAgICAgICBjb25maWdfdGJsLmFudGlhaW1bdmFsdWVdW2tdID0gdWkuZ2V0KHYpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgDQogICAgICAgIGZvciB0YWJfbmFtZSwgdGFiX3NldHRpbmdzIGluIHBhaXJzKG1lbnUpIGRvDQogICAgICAgICAgICBpZiB0YWJfbmFtZSB+PSAiY29uZmlndXJhdGlvbl90YWIiIHRoZW4NCiAgICAgICAgICAgICAgICBjb25maWdfdGJsLmFudGlhaW1fdGFiW3RhYl9uYW1lXSA9IHt9DQogICAgICAgICAgICAgICAgZm9yIHNldHRpbmdfbmFtZSwgc2V0dGluZyBpbiBwYWlycyh0YWJfc2V0dGluZ3MpIGRvDQogICAgICAgICAgICAgICAgICAgIGNvbmZpZ190YmwuYW50aWFpbV90YWJbdGFiX25hbWVdW3NldHRpbmdfbmFtZV0gPSB1aS5nZXQoc2V0dGluZykNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICBsb2NhbCBjZmcgPSBjb25maWdfc3lzdGVtLmdldF9jb25maWcobmFtZSkNCiAgICANCiAgICAgICAgaWYgbm90IGNmZyB0aGVuDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQoZGIsIHsgbmFtZSA9IG5hbWUsIGNvbmZpZyA9IGpzb24uc3RyaW5naWZ5KGNvbmZpZ190YmwpIH0pDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIGRiW2NmZy5pbmRleF0uY29uZmlnID0ganNvbi5zdHJpbmdpZnkoY29uZmlnX3RibCkNCiAgICAgICAgZW5kDQogICAgDQogICAgICAgIGRhdGFiYXNlLndyaXRlKGx1YS5kYXRhYmFzZS5jb25maWdzLCBkYikNCiAgICBlbmQsICAgICAgICANCiAgICBkZWxldGVfY29uZmlnID0gZnVuY3Rpb24obmFtZSkNCiAgICAgICAgbG9jYWwgZGIgPSBkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSBvciB7fQ0KDQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKGRiKSBkbw0KICAgICAgICAgICAgaWYgdi5uYW1lID09IG5hbWUgdGhlbg0KICAgICAgICAgICAgICAgIHRhYmxlLnJlbW92ZShkYiwgaSkNCiAgICAgICAgICAgICAgICBicmVhaw0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KDQogICAgICAgIGZvciBpLCB2IGluIHBhaXJzKHByZXNldHMpIGRvDQogICAgICAgICAgICBpZiB2Lm5hbWUgPT0gbmFtZSB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIGZhbHNlDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQoNCiAgICAgICAgZGF0YWJhc2Uud3JpdGUobHVhLmRhdGFiYXNlLmNvbmZpZ3MsIGRiKQ0KICAgIGVuZCwNCiAgICBsb2FkX2NvbmZpZ19saXN0ID0gZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBkYXRhYmFzZSA9IGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpIG9yIHt9DQogICAgICAgIGxvY2FsIGNvbmZpZyA9IHt9DQoNCiAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMocHJlc2V0cykgZG8NCiAgICAgICAgICAgIHRhYmxlLmluc2VydChjb25maWcsIHYubmFtZSkNCiAgICAgICAgZW5kDQoNCiAgICAgICAgZm9yIGksIHYgaW4gcGFpcnMoZGF0YWJhc2UpIGRvDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQoY29uZmlnLCB2Lm5hbWUpDQogICAgICAgIGVuZA0KDQogICAgICAgIHJldHVybiBjb25maWcNCiAgICBlbmQsDQogICAgbG9hZF9jb25maWcgPSBmdW5jdGlvbihuYW1lKQ0KICAgICAgICBsb2NhbCBjZmcgPSBjb25maWdfc3lzdGVtLmdldF9jb25maWcobmFtZSkNCiAgICAgICAgY29uZmlnX3N5c3RlbS5sb2FkX3NldHRpbmdzKGpzb24ucGFyc2UoY2ZnLmNvbmZpZykpDQogICAgZW5kLA0KICAgIGxvYWRfc2V0dGluZ3MgPSBmdW5jdGlvbihjb25maWcpDQoNCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnMobHVhLnZhcnMucGxheWVyX3N0YXRlc19hYnJldikgZG8NCiAgICAgICAgICAgIGZvciBrLCB2IGluIHBhaXJzKGFudGlhaW1fYnVpbGRlcl90Ymxba2V5XSkgZG8NCiAgICAgICAgICAgICAgICBpZiB2IH49IG5pbCB0aGVuDQogICAgICAgICAgICAgICAgICAgIHVpLnNldCh2LCBjb25maWcuYW50aWFpbVt2YWx1ZV1ba10pDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIA0KICAgICAgICBmb3IgdGFiX25hbWUsIHRhYl9zZXR0aW5ncyBpbiBwYWlycyhjb25maWcuYW50aWFpbV90YWIgb3Ige30pIGRvDQogICAgICAgICAgICBmb3Igc2V0dGluZ19uYW1lLCBzZXR0aW5nX3ZhbHVlIGluIHBhaXJzKHRhYl9zZXR0aW5ncykgZG8NCiAgICAgICAgICAgICAgICBpZiBzZXR0aW5nX3ZhbHVlIH49IG5pbCB0aGVuDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChtZW51W3RhYl9uYW1lXVtzZXR0aW5nX25hbWVdLCBzZXR0aW5nX3ZhbHVlKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCwNCiAgICBpbXBvcnRfc2V0dGluZ3MgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIGNvbmZpZyA9IGpzb24ucGFyc2UoY2xpcGJvYXJkLmdldCgpKQ0KDQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKGx1YS52YXJzLnBsYXllcl9zdGF0ZXNfYWJyZXYpIGRvDQogICAgICAgICAgICBmb3IgaywgdiBpbiBwYWlycyhhbnRpYWltX2J1aWxkZXJfdGJsW2tleV0pIGRvDQogICAgICAgICAgICAgICAgaWYgdiB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQodiwgY29uZmlnLmFudGlhaW1bdmFsdWVdW2tdKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgICAgICANCiAgICAgICAgZm9yIHRhYl9uYW1lLCB0YWJfc2V0dGluZ3MgaW4gcGFpcnMoY29uZmlnLmFudGlhaW1fdGFiIG9yIHt9KSBkbw0KICAgICAgICAgICAgZm9yIHNldHRpbmdfbmFtZSwgc2V0dGluZ192YWx1ZSBpbiBwYWlycyh0YWJfc2V0dGluZ3MpIGRvDQogICAgICAgICAgICAgICAgaWYgc2V0dGluZ192YWx1ZSB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQobWVudVt0YWJfbmFtZV1bc2V0dGluZ19uYW1lXSwgc2V0dGluZ192YWx1ZSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQsDQogICAgZXhwb3J0X3NldHRpbmdzID0gZnVuY3Rpb24obmFtZSkNCiAgICAgICAgbG9jYWwgY29uZmlnID0gew0KICAgICAgICAgICAgYW50aWFpbSA9IHt9LA0KICAgICAgICAgICAgYW50aWFpbV90YWIgPSB7fQ0KICAgICAgICB9DQoNCiAgICAgICAgZm9yIGtleSwgdmFsdWUgaW4gcGFpcnMobHVhLnZhcnMucGxheWVyX3N0YXRlc19hYnJldikgZG8NCiAgICAgICAgICAgIGNvbmZpZy5hbnRpYWltW3ZhbHVlXSA9IHt9DQogICAgICAgICAgICBmb3IgaywgdiBpbiBwYWlycyhhbnRpYWltX2J1aWxkZXJfdGJsW2tleV0pIGRvDQogICAgICAgICAgICAgICAgY29uZmlnLmFudGlhaW1bdmFsdWVdW2tdID0gdWkuZ2V0KHYpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQoNCiAgICAgICAgZm9yIHRhYl9uYW1lLCB0YWJfc2V0dGluZ3MgaW4gcGFpcnMobWVudSkgZG8NCiAgICAgICAgICAgIGlmIHRhYl9uYW1lIH49ICJjb25maWd1cmF0aW9uX3RhYiIgdGhlbg0KICAgICAgICAgICAgICAgIGNvbmZpZy5hbnRpYWltX3RhYlt0YWJfbmFtZV0gPSB7fQ0KICAgICAgICAgICAgICAgIGZvciBzZXR0aW5nX25hbWUsIHNldHRpbmcgaW4gcGFpcnModGFiX3NldHRpbmdzKSBkbw0KICAgICAgICAgICAgICAgICAgICBjb25maWcuYW50aWFpbV90YWJbdGFiX25hbWVdW3NldHRpbmdfbmFtZV0gPSB1aS5nZXQoc2V0dGluZykNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICAgICAgDQogICAgICAgIGNsaXBib2FyZC5zZXQoanNvbi5zdHJpbmdpZnkoY29uZmlnKSkNCiAgICBlbmQsDQogICAgY3JlYXRlX2RiID0gZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBjb25maWdzID0gbHVhLmRhdGFiYXNlLmNvbmZpZ3MNCiAgICAgICAgaWYgbm90IGRhdGFiYXNlLnJlYWQoY29uZmlncykgdGhlbg0KICAgICAgICAgICAgZGF0YWJhc2Uud3JpdGUoY29uZmlncywge30pDQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICBodHRwLmdldCgiaHR0cHM6Ly9wYXN0ZWJpbi5jb20vcmF3L21oOUNldWRkIiwgZnVuY3Rpb24oc3VjY2VzcywgcmVzcG9uc2UpDQogICAgICAgICAgICBpZiBub3Qgc3VjY2VzcyB0aGVuDQogICAgICAgICAgICAgICAgcHJpbnQoIkZhaWxlZCB0byBnZXQgcHJlc2V0cyIpDQogICAgICAgICAgICAgICAgcmV0dXJuDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgbG9jYWwgZGF0YSA9IGpzb24ucGFyc2UocmVzcG9uc2UuYm9keSkNCiAgICAgICAgICAgIA0KICAgICAgICAgICAgZm9yIGksIHByZXNldCBpbiBwYWlycyhkYXRhLnByZXNldHMpIGRvDQogICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KHByZXNldHMsIHsgbmFtZSA9IHByZXNldC5uYW1lLCBjb25maWcgPSBqc29uLnN0cmluZ2lmeShwcmVzZXQuY29uZmlnKSB9KQ0KICAgICAgICAgICAgICAgIHVpLnNldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUsIHByZXNldC5uYW1lKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWd1cmF0aW9uX3RhYi5saXN0LCBjb25maWdfc3lzdGVtLmxvYWRfY29uZmlnX2xpc3QoKSkNCiAgICAgICAgZW5kKQ0KICAgIGVuZCwNCn0NCg0KY29uZmlnX3N5c3RlbS5jcmVhdGVfZGIoKQ0KDQoNCmRlc3luY19mdW5jdGlvbnMgPSB7fQ0KZGVmZW5zaXZlX2Z1bmN0aW9ucyA9IHt9DQphbnRpYWltX2Z1bmN0aW9ucyA9IHt9DQoNCmRlc3luY19mdW5jdGlvbnMgPSB7DQoNCiAgICBmaXJpbmdfdGltZSA9IDAsDQogICAgeWF3ID0gMCwNCiAgICBwaXRjaCA9IDAsDQoNCiAgICBfZmlyaW5nID0gZnVuY3Rpb24oY21kKQ0KDQogICAgICAgIGxvY2FsIGNsaWVudF93ZWFwb24gPSBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkNCg0KICAgICAgICBpZiBub3QgY2xpZW50X3dlYXBvbiB0aGVuDQogICAgICAgICAgICByZXR1cm4gZmFsc2UNCiAgICAgICAgZW5kDQogICAgICAgIA0KICAgICAgICBpZiBjbWQuaW5fYXR0YWNrID09IDEgb3IgY21kLmluX2F0dGFjazIgPT0gMSB0aGVuDQogICAgICAgICAgICBpZiBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpOmZpbmQoIkdyZW5hZGUiKSB0aGVuDQogICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5maXJpbmdfdGltZSA9IGdsb2JhbHMuY3VydGltZSgpICsgMC4yMA0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIGRlc3luY19mdW5jdGlvbnMuZmlyaW5nX3RpbWUgPSBnbG9iYWxzLmN1cnRpbWUoKSArIDAuMDAxDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgZGVzeW5jX2Z1bmN0aW9ucy5maXJpbmdfdGltZSA+IGdsb2JhbHMuY3VydGltZSgpIHRoZW4NCiAgICAgICAgICAgIHJldHVybiBmYWxzZQ0KICAgICAgICBlbmQNCg0KICAgICAgICByZXR1cm4gdHJ1ZQ0KICAgIGVuZCwNCg0KDQogICAgX2Nob2tpbmcgPSBmdW5jdGlvbihjbWQpDQogICAgICAgIGxvY2FsIGRvdWJsZXRhcF9hY3RpdmUgPSB1aS5nZXQocmVmcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQocmVmcy5kb3VibGV0YXBbMl0pDQogICAgICAgIGxvY2FsIG9uc2hvdF9hY3RpdmUgPSB1aS5nZXQocmVmcy5vbnNob3RbMV0pIGFuZCB1aS5nZXQocmVmcy5vbnNob3RbMl0pDQogICAgICAgIGxvY2FsIGZha2VkdWNrX2FjdGl2ZSA9IHVpLmdldChyZWZzLmZha2VkdWNrKQ0KICAgICAgICBsb2NhbCBmYWtlbGFnX2xpbWl0ID0gdWkuZ2V0KHJlZnMuZmFrZWxhZ19saW1pdCkNCg0KICAgICAgICBpZiBub3QgZG91YmxldGFwX2FjdGl2ZSBhbmQgbm90IG9uc2hvdF9hY3RpdmUgYW5kIG5vdCBjbWQubm9fY2hva2Ugb3IgZmFrZWR1Y2tfYWN0aXZlIHRoZW4NCiAgICAgICAgICAgIGlmIGNtZC5jaG9rZWRjb21tYW5kcyA+PSAwIGFuZCBjbWQuY2hva2VkY29tbWFuZHMgPCBmYWtlbGFnX2xpbWl0IHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gY21kLmNob2tlZGNvbW1hbmRzICUgMiA9PSAwDQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIGNtZC5jaG9rZWRjb21tYW5kcyAlIDIgPT0gMQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHJldHVybiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMA0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBfcnVuID0gZnVuY3Rpb24oY21kLCBmYWtlLCB5YXcsIHBpdGNoKQ0KICAgICAgICBsb2NhbCB1c2VyX2NtZCA9IGdldF9pbnB1dF92ZnVuY19wdHIudmZwdHIuR2V0VXNlckNtZChmZmkuY2FzdCgidWludHB0cl90IiwgZ2V0X2lucHV0X3ZmdW5jX3B0ciksIDAsIGNtZC5jb21tYW5kX251bWJlcikNCiAgICAgICAgbG9jYWwgZXllX2FuZ2xlcyA9IHtlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fYW5nRXllQW5nbGVzIil9DQogICAgICAgIGxvY2FsIGNhbV9waXRjaCwgY2FtX3lhdyA9IGNsaWVudC5jYW1lcmFfYW5nbGVzKCkNCiAgICAgICAgbG9jYWwgeWF3X2Jhc2UgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLnlhd19iYXNlKQ0KICAgICAgICBsb2NhbCBub3JtYWxpemVkX3lhdyA9IDANCg0KICAgICAgICANCiAgICAgICAgaWYgeWF3X2Jhc2UgPT0gIkF0IHRhcmdldHMiIGFuZCBjbGllbnQuY3VycmVudF90aHJlYXQoKSB0aGVuDQogICAgICAgICAgICBub3JtYWxpemVkX3lhdyA9IGV5ZV9hbmdsZXNbMl0NCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgbm9ybWFsaXplZF95YXcgPSBsdWEuZnVuY3Mubm9ybWFsaXplKGNhbV95YXcpICsgeWF3DQogICAgICAgIGVuZA0KDQoNCiAgICAgICAgdWkuc2V0KHJlZnMuYm9keXlhd1sxXSwgZGVzeW5jX2Z1bmN0aW9ucy5fY2hva2luZyhjbWQpIGFuZCAiU3RhdGljIiBvciAiT2ZmIikNCg0KICAgICAgICBpZiBjbWQuY2hva2VkY29tbWFuZHMgPT0gMCB0aGVuDQogICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLnlhdyA9IG5vcm1hbGl6ZWRfeWF3IC0gZmFrZSoyDQogICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLnBpdGNoID0gcGl0Y2gNCiAgICAgICAgZW5kDQogICAgICAgIA0KICAgICAgICBjbWQuYWxsb3dfc2VuZF9wYWNrZXQgPSBmYWxzZQ0KICAgICAgICBpZiBkZXN5bmNfZnVuY3Rpb25zLl9maXJpbmcoY21kKSB0aGVuDQogICAgICAgICAgICBpZiBub3QgdXNlcl9jbWQuaGFzYmVlbnByZWRpY3RlZCB0aGVuDQogICAgICAgICAgICAgICAgaWYgZGVzeW5jX2Z1bmN0aW9ucy5fY2hva2luZyhjbWQpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgY21kLnlhdyA9IGRlc3luY19mdW5jdGlvbnMueWF3DQogICAgICAgICAgICAgICAgICAgIGNtZC5waXRjaCA9IGRlc3luY19mdW5jdGlvbnMucGl0Y2gNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQsDQp9DQoNCmRlZmVuc2l2ZV9mdW5jdGlvbnMgPSB7DQogICAgbGFzdHNpbXRpbWUgPSAwLA0KICAgIHVudGlsX3RpY2sgPSAwLA0KICAgIHRpY2tzID0gMCwNCiAgICBhY3RpdmUgPSBmYWxzZSwNCiAgICB0aW1lID0gMCwNCiAgICBwaXRjaF9hY3RpdmUgPSBmYWxzZSwNCiAgICB5YXdfYWN0aXZlID0gZmFsc2UsDQoNCiAgICBkZWZlbnNpdmVfY2hlY2sgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIGxvY2FsX3BsYXllciA9IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkNCiAgICAgICAgaWYgbm90IGxvY2FsX3BsYXllciB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBhbnRpYWltX3NlbGVjdGlvbiA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKQ0KICAgICAgICBpZiBub3QgKGx1YS5mdW5jcy50YWJsZV9jb250YWlucyhhbnRpYWltX3NlbGVjdGlvbiwgIlBpdGNoIikgb3IgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKGFudGlhaW1fc2VsZWN0aW9uLCAiWWF3IikpIHRoZW4NCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBlbmQNCg0KICAgICAgICBsb2NhbCBjdXJzaW10aW1lID0gdG90aWNrcyhlbnRpdHkuZ2V0X3Byb3AobG9jYWxfcGxheWVyLCAibV9mbFNpbXVsYXRpb25UaW1lIikpDQogICAgICAgIGxvY2FsIHNpbWRpZiA9IGRlZmVuc2l2ZV9mdW5jdGlvbnMubGFzdHNpbXRpbWUgLSBjdXJzaW10aW1lDQoNCiAgICAgICAgaWYgc2ltZGlmID4gMCB0aGVuDQogICAgICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLnVudGlsX3RpY2sgPSBnbG9iYWxzLnRpY2tjb3VudCgpICsgbWF0aC5hYnMoc2ltZGlmKSAtIHRvdGlja3MoY2xpZW50LmxhdGVuY3koKSkNCiAgICAgICAgICAgIGRlZmVuc2l2ZV9mdW5jdGlvbnMudGlja3MgPSBkZWZlbnNpdmVfZnVuY3Rpb25zLnVudGlsX3RpY2sgLSBnbG9iYWxzLnRpY2tjb3VudCgpDQogICAgICAgIGVuZA0KDQogICAgICAgIGRlZmVuc2l2ZV9mdW5jdGlvbnMuYWN0aXZlID0gZGVmZW5zaXZlX2Z1bmN0aW9ucy51bnRpbF90aWNrID4gZ2xvYmFscy50aWNrY291bnQoKQ0KICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLmxhc3RzaW10aW1lID0gY3Vyc2ltdGltZQ0KICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLnRpbWUgPSBkZWZlbnNpdmVfZnVuY3Rpb25zLnRpY2tzIC0gKGRlZmVuc2l2ZV9mdW5jdGlvbnMudW50aWxfdGljayAtIGdsb2JhbHMudGlja2NvdW50KCkpDQogICAgICAgIA0KICAgICAgICByZXR1cm4gZGVmZW5zaXZlX2Z1bmN0aW9ucw0KICAgIGVuZCwNCg0KICAgIGdldF9kZWZlbnNpdmVfeWF3X3ZhbHVlcyA9IGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgeWF3X29wdGlvbnMgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmRlZmVuc2l2ZV95YXdfb3B0aW9ucykNCiAgICAgICAgbG9jYWwgY3VyX3RpbWUgPSBnbG9iYWxzLmN1cnRpbWUoKQ0KICAgICAgICBsb2NhbCB0aWNrX2NvdW50ID0gZ2xvYmFscy50aWNrY291bnQoKQ0KDQogICAgICAgIGlmIHlhd19vcHRpb25zID09ICdGb3J3YXJkJyB0aGVuDQogICAgICAgICAgICByZXR1cm4gdGlja19jb3VudCAlIDMgPT0gMCBhbmQgLTE1NSBvciAxNTUNCiAgICAgICAgZWxzZWlmIHlhd19vcHRpb25zID09ICdGbGljaycgdGhlbg0KICAgICAgICAgICAgbG9jYWwgYW5nbGUxID0gdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5kZWZlbnNpdmVfeWF3X2ZsaWNrX2FuZ2xlMSkNCiAgICAgICAgICAgIGxvY2FsIGFuZ2xlMiA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZGVmZW5zaXZlX3lhd19mbGlja19hbmdsZTIpDQogICAgICAgICAgICByZXR1cm4gdGlja19jb3VudCAlIDMgPT0gMCBhbmQgYW5nbGUxIG9yIGFuZ2xlMg0KICAgICAgICBlbHNlaWYgeWF3X29wdGlvbnMgPT0gJ1NwaW4nIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIHNwZWVkID0gdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5kZWZlbnNpdmVfeWF3X3NwaW5fc3BlZWQpDQogICAgICAgICAgICBsb2NhbCByYW5nZSA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZGVmZW5zaXZlX3lhd19zcGluX3JhbmdlKQ0KICAgICAgICAgICAgcmV0dXJuIC1tYXRoLmZtb2QoY3VyX3RpbWUgKiAoc3BlZWQgKiAzNjApLCByYW5nZSAqIDIpICsgcmFuZ2UNCiAgICAgICAgZWxzZWlmIHlhd19vcHRpb25zID09ICdEaXN0b3J0aW9uJyB0aGVuDQogICAgICAgICAgICBsb2NhbCBzcGVlZCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZGVmZW5zaXZlX3lhd19kaXN0b3J0aW9uX3NwZWVkKQ0KICAgICAgICAgICAgbG9jYWwgcmFuZ2UgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmRlZmVuc2l2ZV95YXdfZGlzdG9ydGlvbl9yYW5nZSkNCiAgICAgICAgICAgIHJldHVybiBtYXRoLnNpbihjdXJfdGltZSAqIHNwZWVkKSAqIHJhbmdlDQogICAgICAgIGVsc2VpZiB5YXdfb3B0aW9ucyA9PSAnUmFuZG9tJyB0aGVuDQogICAgICAgICAgICBsb2NhbCByYW5kb21fcmFuZ2UgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmRlZmVuc2l2ZV95YXdfcmFuZG9tX3JhbmdlKQ0KICAgICAgICAgICAgcmV0dXJuIG1hdGgucmFuZG9tKC1yYW5kb21fcmFuZ2UgLyAyLCByYW5kb21fcmFuZ2UgLyAyKQ0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBnZXRfZGVmZW5zaXZlX3BpdGNoX3ZhbHVlcyA9IGZ1bmN0aW9uKCkNCiAgICAgICAgbG9jYWwgcGl0Y2hfb3B0aW9ucyA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZGVmZW5zaXZlX3BpdGNoX29wdGlvbnMpDQogICAgICAgIA0KICAgICAgICBpZiBwaXRjaF9vcHRpb25zID09ICdVcCcgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIC04OQ0KICAgICAgICBlbHNlaWYgcGl0Y2hfb3B0aW9ucyA9PSAnSGFsZi11cCcgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIC00NQ0KICAgICAgICBlbHNlaWYgcGl0Y2hfb3B0aW9ucyA9PSAnWmVybycgdGhlbg0KICAgICAgICAgICAgcmV0dXJuIDANCiAgICAgICAgZWxzZWlmIHBpdGNoX29wdGlvbnMgPT0gJ0ZsaWNrJyB0aGVuDQogICAgICAgICAgICBsb2NhbCBmbGljazEgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmRlZmVuc2l2ZV9waXRjaF9mbGlja19kZWdyZWUxKQ0KICAgICAgICAgICAgbG9jYWwgZmxpY2syID0gdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5kZWZlbnNpdmVfcGl0Y2hfZmxpY2tfZGVncmVlMikNCiAgICAgICAgICAgIHJldHVybiBnbG9iYWxzLnRpY2tjb3VudCgpICUgMyA9PSAwIGFuZCBmbGljazEgb3IgZmxpY2syDQogICAgICAgIGVsc2VpZiBwaXRjaF9vcHRpb25zID09ICdSYW5kb20nIHRoZW4NCiAgICAgICAgICAgIHJldHVybiBtYXRoLnJhbmRvbSgtODksIDg5KQ0KICAgICAgICBlbHNlaWYgcGl0Y2hfb3B0aW9ucyA9PSAnQ3VzdG9tJyB0aGVuDQogICAgICAgICAgICByZXR1cm4gdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5kZWZlbnNpdmVfcGl0Y2hfY3VzdG9tKQ0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBfcnVuID0gZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBsb2NhbF9wbGF5ZXIgPSBlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpDQogICAgICAgIGlmIG5vdCBsb2NhbF9wbGF5ZXIgdGhlbiByZXR1cm4gZW5kDQoNCiAgICAgICAgbG9jYWwgYW50aWFpbV9zZWxlY3Rpb24gPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmRlZmVuc2l2ZV9hbnRpYWltX3NlbGVjdGlvbikNCiAgICAgICAgaWYgbm90IChsdWEuZnVuY3MudGFibGVfY29udGFpbnMoYW50aWFpbV9zZWxlY3Rpb24sICJQaXRjaCIpIG9yIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyhhbnRpYWltX3NlbGVjdGlvbiwgIllhdyIpKSB0aGVuDQogICAgICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLmFjdGl2ZSA9IGZhbHNlDQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZW5kDQoNCiAgICAgICAgbG9jYWwgZGVmZW5zaXZlX2NoZWNrID0gZGVmZW5zaXZlX2Z1bmN0aW9ucy5kZWZlbnNpdmVfY2hlY2soKQ0KICAgICAgICBpZiBkZWZlbnNpdmVfY2hlY2suYWN0aXZlIHRoZW4NCiAgICAgICAgICAgIGlmIGFudGlhaW1fZnVuY3Rpb25zLnNhZmVfa25pZmUgdGhlbiByZXR1cm4gZW5kDQogICAgICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnMoYW50aWFpbV9zZWxlY3Rpb24sICJQaXRjaCIpIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIkN1c3RvbSIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMl0sIGRlZmVuc2l2ZV9mdW5jdGlvbnMuZ2V0X2RlZmVuc2l2ZV9waXRjaF92YWx1ZXMoKSkNCiAgICAgICAgICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLnBpdGNoX2FjdGl2ZSA9IHRydWUNCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnMoYW50aWFpbV9zZWxlY3Rpb24sICJZYXciKSB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCBkZWZlbnNpdmVfZnVuY3Rpb25zLmdldF9kZWZlbnNpdmVfeWF3X3ZhbHVlcygpKQ0KICAgICAgICAgICAgICAgIGRlZmVuc2l2ZV9mdW5jdGlvbnMueWF3X2FjdGl2ZSA9IHRydWUNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICBkZWZlbnNpdmVfZnVuY3Rpb25zLnBpdGNoX2FjdGl2ZSA9IGZhbHNlDQogICAgICAgIGRlZmVuc2l2ZV9mdW5jdGlvbnMueWF3X2FjdGl2ZSA9IGZhbHNlDQogICAgZW5kLA0KfQ0KDQphbnRpYWltX2Z1bmN0aW9ucyA9IHsNCg0KICAgIGRlbGF5X3Nob3QgPSB1aS5uZXdfY2hlY2tib3goIlJBR0UiLCAiQWltYm90IiwgIkRlbGF5IHNob3QiKSwNCiAgICBvbnVzZV9hbnRpYWltID0gZmFsc2UsDQogICAgYXZvaWRfYmFja3N0YWJfYm9vbCA9IGZhbHNlLA0KICAgIHNhZmVfa25pZmUgPSBmYWxzZSwNCiAgICBtYW51YWxfYW50aWFpbV9ib29sID0gZmFsc2UsDQogICAgcm91bmRfZW5kID0gZmFsc2UsDQogICAgbWFudWFsX2FudGlhaW1fdGJsID0gew0KICAgICAgICBsYXN0X2ZvcndhcmQsDQogICAgICAgIGxhc3RfbGVmdCwNCiAgICAgICAgbGFzdF9yaWdodCwNCiAgICAgICAgbWFudWFsX3NpZGUsDQogICAgfSwNCg0KICAgIGFudGlhaW1fc3RhdGUgPSBmdW5jdGlvbihjbWQpDQoNCiAgICAgICAgdWkuc2V0KHJlZnMuZW5hYmxlZCwgdHJ1ZSkNCg0KICAgICAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSBvciBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGxvY2FsIGZsYWdzID0gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZGbGFncyIpDQogICAgICAgIGxvY2FsIG9uZ3JvdW5kID0gYml0LmJhbmQoZmxhZ3MsIDEpIH49IDAgYW5kIGNtZC5pbl9qdW1wID09IDANCiAgICAgICAgbG9jYWwgdmVsb2NpdHkgPSB2ZWN0b3IoZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX3ZlY1ZlbG9jaXR5IikpDQogICAgICAgIGxvY2FsIGxwX3ZlbG9jaXR5ID0gbWF0aC5zcXJ0KHZlbG9jaXR5LnheMiArIHZlbG9jaXR5LnleMikgPCA1DQogICAgICAgIGxvY2FsIGRvdWJsZXRhcF9hY3RpdmUgPSB1aS5nZXQocmVmcy5kb3VibGV0YXBbMV0pIGFuZCB1aS5nZXQocmVmcy5kb3VibGV0YXBbMl0pDQogICAgICAgIGxvY2FsIG9uc2hvdF9hY3RpdmUgPSB1aS5nZXQocmVmcy5vbnNob3RbMV0pIGFuZCB1aS5nZXQocmVmcy5vbnNob3RbMl0pDQoNCg0KICAgICAgICBsb2NhbCBnZXRfcGxheWVyX3N0YXRlID0gZnVuY3Rpb24oKQ0KICAgICAgICAgICAgaWYgbm90IG9uZ3JvdW5kIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4gZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsRHVja0Ftb3VudCIpID4gMC4xIGFuZCA3IG9yIDYNCiAgICAgICAgICAgIGVsc2VpZiBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxEdWNrQW1vdW50IikgPiAwLjEgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiBscF92ZWxvY2l0eSBhbmQgNSBvciA4DQogICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KHJlZnMuc2xvd19tb3Rpb25bMV0pIGFuZCB1aS5nZXQocmVmcy5zbG93X21vdGlvblsyXSkgYW5kIG5vdCBscF92ZWxvY2l0eSB0aGVuDQogICAgICAgICAgICAgICAgcmV0dXJuIDQNCiAgICAgICAgICAgIGVsc2VpZiBub3QgbHBfdmVsb2NpdHkgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiAzDQogICAgICAgICAgICBlbHNlaWYgbHBfdmVsb2NpdHkgdGhlbg0KICAgICAgICAgICAgICAgIHJldHVybiAyDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIHJldHVybiAxDQogICAgICAgIGVuZA0KDQogICAgICAgIGx1YS52YXJzLnBsYXllcl9zdGF0ZSA9IGdldF9wbGF5ZXJfc3RhdGUoKQ0KDQogICAgICAgIGlmIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsWzldLmVuYWJsZV9zdGF0ZSkgYW5kIG5vdCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbOV0uc3RhdGVfZGlzYWJsZXJzKSwgbHVhLnZhcnMuaW50X3RvX3N0cmluZ1tsdWEudmFycy5wbGF5ZXJfc3RhdGVdKSBhbmQgbm90IGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZlX2hlYWRfc3RhdGVzKSwgbHVhLnZhcnMuaW50X3RvX3N0cmluZ1tsdWEudmFycy5wbGF5ZXJfc3RhdGVdKSBhbmQgbm90IGRvdWJsZXRhcF9hY3RpdmUgYW5kIG5vdCBvbnNob3RfYWN0aXZlIHRoZW4NCiAgICAgICAgICAgIGx1YS52YXJzLnBsYXllcl9zdGF0ZSA9IDkNCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgbm90IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZW5hYmxlX3N0YXRlKSBhbmQgbHVhLnZhcnMucGxheWVyX3N0YXRlIH49IDEgdGhlbg0KICAgICAgICAgICAgbHVhLnZhcnMucGxheWVyX3N0YXRlID0gMQ0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBhbnRpYWltX2hhbmRsZSA9IGZ1bmN0aW9uKGNtZCkNCg0KICAgICAgICBpZiBub3QgZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSBvciBub3QgZW50aXR5LmlzX2FsaXZlKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGlmIGFudGlhaW1fZnVuY3Rpb25zLm9udXNlX2FudGlhaW0gb3IgZGVmZW5zaXZlX2Z1bmN0aW9ucy5hY3RpdmUgdGhlbiByZXR1cm4gZW5kDQoNCiAgICAgICAgaWYgY21kLmluX3VzZSA9PSAxIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGlmIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZW5hYmxlX3N0YXRlKSB0aGVuDQoNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZha2VsYWdfbW9kZSwgIk1heGltdW0iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZmFrZWxhZ192YXJpYW5jZSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZha2VsYWdfbGltaXQsIDE0KQ0KDQogICAgICAgICAgICBpZiBlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBub3QgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKTpmaW5kKCJHcmVuYWRlIikgdGhlbg0KICAgICAgICAgICAgICAgICAgICBpZiB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmZvcmNlX2RlZmVuc2l2ZV9leHBsb2l0KSA9PSAiQWx3YXlzIG9uIiB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBlbHNlaWYgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5mb3JjZV9kZWZlbnNpdmVfZXhwbG9pdCkgPT0gIkNvbW1hbmQgYmFzZWQiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGNtZC5mb3JjZV9kZWZlbnNpdmUgPSBjbWQuY29tbWFuZF9udW1iZXIgJSAyID09IDENCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICBjbWQuZm9yY2VfZGVmZW5zaXZlID0gZmFsc2UNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICBpZiBub3QgZGVmZW5zaXZlX2Z1bmN0aW9ucy5waXRjaF9hY3RpdmUgdGhlbg0KICAgICAgICAgICAgICAgIGxvY2FsIHBpdGNoX3NldHRpbmcgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLnBpdGNoKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCBwaXRjaF9zZXR0aW5nKQ0KICAgICAgICAgICAgICAgIGlmIHBpdGNoX3NldHRpbmcgPT0gIkN1c3RvbSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsyXSwgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5waXRjaF9zbGlkZXIpKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd19iYXNlLCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLnlhd19iYXNlKSkNCg0KICAgICAgICAgICAgbG9jYWwgeWF3X21vZGUgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLnlhdykNCiAgICAgICAgICAgIGxvY2FsIHNpZGUgPSAobWF0aC5mbG9vcihtYXRoLmFicyhlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMTEpICogMTIwKSkgLSA2MCkgPiAwIGFuZCAxIG9yIC0xDQogICAgICAgICAgICBsb2NhbCBib2R5X3lhd19tb2RlID0gdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5ib2R5eWF3KQ0KDQoNCiAgICAgICAgICAgIGlmIG5vdCBkZWZlbnNpdmVfZnVuY3Rpb25zLnlhd19hY3RpdmUgdGhlbg0KICAgICAgICAgICAgICAgIGlmIHlhd19tb2RlIH49ICJPZmYiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgICAgICAgICAgaWYgeWF3X21vZGUgPT0gIkwmUiIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgYm9keV95YXdfbW9kZSA9PSAiU3RhdGljIiBvciBib2R5X3lhd19tb2RlID09ICJPZmYiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID49IDIgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0ueWF3X2xlZnQpIG9yIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0ueWF3X3JpZ2h0KSkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIHNpZGUgPT0gMSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS55YXdfbGVmdCkgb3IgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS55YXdfcmlnaHQpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS55YXdfc3RhdGljKSkNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDApDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCg0KIA0KDQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMV0sIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0ueWF3aml0dGVyKSkNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsyXSwgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS55YXdqaXR0ZXJfcmFuZG9tKSkNCg0KICAgICAgICAgICAgbG9jYWwgZmFrZV9saW1pdCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZmFrZV9saW1pdCkNCiAgICAgICAgICAgIGxvY2FsIGZha2VfbGltaXRfbGVmdCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZmFrZV9saW1pdF9sZWZ0KQ0KICAgICAgICAgICAgbG9jYWwgZmFrZV9saW1pdF9yaWdodCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZmFrZV9saW1pdF9yaWdodCkNCiAgICAgICAgICAgIGxvY2FsIGZha2VfbGltaXRfZGVsYXlfdGlja3MgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmZha2VfbGltaXRfZGVsYXlfdGlja3MpDQogICAgICAgICAgICBsb2NhbCBmYWtlX2xpbWl0X2xlZnRfZGVsYXllZCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uZmFrZV9saW1pdF9sZWZ0X2RlbGF5ZWQpDQogICAgICAgICAgICBsb2NhbCBmYWtlX2xpbWl0X3JpZ2h0X2RlbGF5ZWQgPSB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtsdWEudmFycy5wbGF5ZXJfc3RhdGVdLmZha2VfbGltaXRfcmlnaHRfZGVsYXllZCkNCg0KICAgICAgICAgICAgaWYgYm9keV95YXdfbW9kZSA9PSAiU3RhdGljIiB0aGVuDQogICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgZmFrZV9saW1pdCwgMTgwLCA4OSkNCiAgICAgICAgICAgIGVsc2VpZiBib2R5X3lhd19tb2RlID09ICJKaXR0ZXIiIHRoZW4NCiAgICAgICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLl9ydW4oY21kLCBnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA+PSAyIGFuZCAtZmFrZV9saW1pdF9sZWZ0IG9yIGZha2VfbGltaXRfcmlnaHQsIDE4MCwgODkpDQogICAgICAgICAgICBlbHNlaWYgYm9keV95YXdfbW9kZSA9PSAiRGVsYXllZCBKaXR0ZXIiIHRoZW4NCiAgICAgICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLl9ydW4oY21kLCBnbG9iYWxzLnRpY2tjb3VudCgpICUgKDIwICogKDAuMSArIGZha2VfbGltaXRfZGVsYXlfdGlja3MvMTApKSA+PSAoMTAgKiAoMC4xICsgZmFrZV9saW1pdF9kZWxheV90aWNrcy8xMCkpIGFuZCAtZmFrZV9saW1pdF9sZWZ0X2RlbGF5ZWQgb3IgZmFrZV9saW1pdF9yaWdodF9kZWxheWVkLCAxODAsIDg5KQ0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHJldHVybg0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMl0sIDApDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mcmVlc3RhbmRpbmdfYm9keXlhdywgZmFsc2UpDQogICAgICAgIGVsc2VpZiBub3QgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbbHVhLnZhcnMucGxheWVyX3N0YXRlXS5lbmFibGVfc3RhdGUpIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiT2ZmIikNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd19iYXNlLCAiTG9jYWwgdmlldyIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAwKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzFdLCAiT2ZmIikNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsyXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMV0sICJPZmYiKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keXlhd1syXSwgMCkNCiAgICAgICAgICAgIHVpLnNldChyZWZzLnJvbGwsIDApDQogICAgICAgIGVuZA0KICAgIGVuZCwNCg0KICAgIGZhc3RfbGFkZGVyID0gZnVuY3Rpb24oY21kKQ0KICAgICAgICBpZiBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fTW92ZVR5cGUiKSB+PSA5IG9yIGNtZC5mb3J3YXJkbW92ZSA9PSAwIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgICAgIGlmIG5vdCB1aS5nZXQobWVudS5hbnRpYWltX3RhYi5mYXN0X2xhZGRlcikgdGhlbiByZXR1cm4gZW5kDQoNCgkJbG9jYWwgY2FtZXJhX3BpdGNoLCBjYW1lcmFfeWF3ID0gY2xpZW50LmNhbWVyYV9hbmdsZXMoKQ0KCQlsb2NhbCBkZXNjZW5kaW5nID0gY21kLmZvcndhcmRtb3ZlIDwgMCBvciBjYW1lcmFfcGl0Y2ggPiA0NQ0KDQogICAgICAgIGlmIGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9Nb3ZlVHlwZSIpID09IDkgdGhlbg0KICAgICAgICAgICAgaWYgY21kLmZvcndhcmRtb3ZlIH49IDAgdGhlbg0KICAgICAgICAgICAgICAgIGNtZC5waXRjaCA9IDg5LjANCiAgICAgICAgICAgICAgICBjbWQueWF3ID0gY21kLnlhdyArIDkwLjANCiAgICAgICAgICAgICAgICBjbWQuaW5fbW92ZWxlZnQsIGNtZC5pbl9tb3ZlcmlnaHQgPSBkZXNjZW5kaW5nIGFuZCAxIG9yIDAsIG5vdCBkZXNjZW5kaW5nIGFuZCAxIG9yIDANCiAgICAgICAgICAgICAgICBjbWQuaW5fZm9yd2FyZCwgY21kLmluX2JhY2sgPSBkZXNjZW5kaW5nIGFuZCAxIG9yIDAsIG5vdCBkZXNjZW5kaW5nIGFuZCAxIG9yIDANCiAgICAgICAgDQogICAgICAgICAgICAgICAgaWYgY21kLnNpZGVtb3ZlID09IDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICBjbWQubW92ZV95YXcgPSBjbWQubW92ZV95YXcgKyA5MA0KICAgICAgICAgICAgICAgIGVsc2VpZiBjbWQuc2lkZW1vdmUgPiAwIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgY21kLm1vdmVfeWF3ID0gY21kLm1vdmVfeWF3ICsgKGNtZC5mb3J3YXJkbW92ZSA+IDAgYW5kIDQwIG9yIDE2MCkNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIGNtZC5tb3ZlX3lhdyA9IGNtZC5tb3ZlX3lhdyArIChjbWQuZm9yd2FyZG1vdmUgPiAwIGFuZCAxNjAgb3IgNDApDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kLA0KDQogICAgc2FmZXR5X29wdGlvbnMgPSB7DQoNCiAgICAgICAgcmFuZG9tX2FhX29uX3dhcm11cCA9IGZ1bmN0aW9uKGNtZCkNCg0KICAgICAgICAgICAgaWYgYW50aWFpbV9mdW5jdGlvbnMub251c2VfYW50aWFpbSBvciBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9hbGwoIkNDU0dhbWVSdWxlc1Byb3h5IilbMV0sIm1fYldhcm11cFBlcmlvZCIpID09IDAgdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuc2FmZXR5X29wdGlvbnMpLCAiUmFuZG9tIGFudGktYWltIikgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5yYW5kb21fYW50aWFpbV9jb25kaXRpb25zKSwgIldhcm11cCIpIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIlJhbmRvbSIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3X2Jhc2UsICJBdCB0YXJnZXRzIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgLW1hdGguZm1vZChnbG9iYWxzLmN1cnRpbWUoKSAqIDk2MCwgMzYwKSArIDE4MCkNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMV0sICJSYW5kb20iKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsyXSwgNjApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keXlhd1syXSwgMCkNCiAgICAgICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLl9ydW4oY21kLCA0OCwgMTgwLCA4OSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQsDQoNCiAgICAgICAgcmFuZG9tX2FhX29uX2ZyZWV6ZSA9IGZ1bmN0aW9uKGNtZCkNCg0KICAgICAgICAgICAgaWYgYW50aWFpbV9mdW5jdGlvbnMub251c2VfYW50aWFpbSBvciBlbnRpdHkuZ2V0X3Byb3AoZW50aXR5LmdldF9hbGwoIkNDU0dhbWVSdWxlc1Byb3h5IilbMV0sIm1fYkZyZWV6ZVBlcmlvZCIpID09IDAgdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuc2FmZXR5X29wdGlvbnMpLCAiUmFuZG9tIGFudGktYWltIikgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5yYW5kb21fYW50aWFpbV9jb25kaXRpb25zKSwgIkZyZWV6ZSB0aW1lIikgdGhlbg0KICAgICAgICAgICAgICAgIGNtZC5waXRjaCA9IGNsaWVudC5yYW5kb21faW50KC04OSwgODkpDQogICAgICAgICAgICAgICAgY21kLnlhdyA9IGNtZC55YXcgKyAoLW1hdGguZm1vZChnbG9iYWxzLmN1cnRpbWUoKSAqIDk2MCwgMzYwKSArIDE4MCkNCiAgICAgICAgICAgICAgICBkZXN5bmNfZnVuY3Rpb25zLl9ydW4oY21kLCA0OCwgMTgwLCA4OSkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQsDQoNCiAgICAgICAgcmFuZG9tX2FhX29uX3JvdW5kX2VuZCA9IGZ1bmN0aW9uKGNtZCkNCg0KICAgICAgICAgICAgaWYgYW50aWFpbV9mdW5jdGlvbnMub251c2VfYW50aWFpbSBvciBub3QgYW50aWFpbV9mdW5jdGlvbnMucm91bmRfZW5kIHRoZW4gcmV0dXJuIGVuZA0KICAgIA0KICAgICAgICAgICAgaWYgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51LmFudGlhaW1fdGFiLnNhZmV0eV9vcHRpb25zKSwgIlJhbmRvbSBhbnRpLWFpbSIpIGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIucmFuZG9tX2FudGlhaW1fY29uZGl0aW9ucyksICJSb3VuZCBlbmQiKSB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJSYW5kb20iKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIC1tYXRoLmZtb2QoZ2xvYmFscy5jdXJ0aW1lKCkgKiA5NjAsIDM2MCkgKyAxODApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzFdLCAiUmFuZG9tIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMl0sIDYwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMl0sIDApDQogICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgNDgsIDE4MCwgODkpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kLA0KDQogICAgICAgIHNhZmVfa25pZmUgPSBmdW5jdGlvbihjbWQpDQoNCiAgICAgICAgICAgIGlmIGFudGlhaW1fZnVuY3Rpb25zLm9udXNlX2FudGlhaW0gb3IgYW50aWFpbV9mdW5jdGlvbnMuYXZvaWRfYmFja3N0YWJfYm9vbCB0aGVuIHJldHVybiBlbmQNCiAgICANCiAgICAgICAgICAgIGlmIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZldHlfb3B0aW9ucyksICJTYWZlIGtuaWZlIikgYW5kIGx1YS52YXJzLnBsYXllcl9zdGF0ZSA9PSA3IGFuZCBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpID09ICJDS25pZmUiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzFdLCAiMTgwIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDgpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzFdLCAiUmFuZG9tIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMl0sIDEwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMl0sIDApDQogICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgNDgsIDE4MCwgODkpDQogICAgICAgICAgICAgICAgYW50aWFpbV9mdW5jdGlvbnMuc2FmZV9rbmlmZSA9IHRydWUNCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZlX2tuaWZlID0gZmFsc2UNCiAgICAgICAgZW5kLA0KDQogICAgICAgIHNhZmVfaGVhZCA9IGZ1bmN0aW9uKGNtZCkNCg0KICAgICAgICAgICAgbG9jYWwgZG91YmxldGFwX2FjdGl2ZSA9IHVpLmdldChyZWZzLmRvdWJsZXRhcFsxXSkgYW5kIHVpLmdldChyZWZzLmRvdWJsZXRhcFsyXSkNCiAgICAgICAgICAgIGxvY2FsIG9uc2hvdF9hY3RpdmUgPSB1aS5nZXQocmVmcy5vbnNob3RbMV0pIGFuZCB1aS5nZXQocmVmcy5vbnNob3RbMl0pDQoNCiAgICAgICAgICAgIGlmIGFudGlhaW1fZnVuY3Rpb25zLm9udXNlX2FudGlhaW0gb3IgYW50aWFpbV9mdW5jdGlvbnMuYXZvaWRfYmFja3N0YWJfYm9vbCB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICAgICAgaWYgbm90IGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZldHlfb3B0aW9ucyksICJTYWZlIGhlYWQiKSB0aGVuIHJldHVybiBlbmQNCiAgICANCiAgICAgICAgICAgIGlmIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZlX2hlYWRfc3RhdGVzKSwgIk9uIFpldXMiKSBhbmQgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKSA9PSAiQ1dlYXBvblRhc2VyIiB0aGVuDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucGl0Y2hbMV0sICJNaW5pbWFsIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMl0sIDApDQogICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgbWF0aC5zaW4oZ2xvYmFscy5yZWFsdGltZSgpICogNjQpICogLTM1ICsgMTAsIDE4MCwgODkpDQogICAgICAgICAgICBlbmQNCg0KICAgICAgICAgICAgaWYgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51LmFudGlhaW1fdGFiLnNhZmVfaGVhZF9zdGF0ZXMpLCBsdWEudmFycy5pbnRfdG9fc3RyaW5nW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0pIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBub3QgZG91YmxldGFwX2FjdGl2ZSBhbmQgbm90IG9uc2hvdF9hY3RpdmUgdGhlbg0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIk1pbmltYWwiKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdfYmFzZSwgIkF0IHRhcmdldHMiKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMV0sICIxODAiKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDApDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd2ppdHRlclsyXSwgMCkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMuYm9keXlhd1syXSwgMCkNCiAgICAgICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgbWF0aC5zaW4oZ2xvYmFscy5yZWFsdGltZSgpICogOCkgKiAtNTggKyAxNSwgMTgwLCA4OSkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQsDQoNCiAgICAgICAgc3RhdGljX29uX2hlaWdodF9hZHZhbnRhZ2UgPSBmdW5jdGlvbihjbWQpDQoNCg0KICAgICAgICAgICAgaWYgYW50aWFpbV9mdW5jdGlvbnMub251c2VfYW50aWFpbSBvciBhbnRpYWltX2Z1bmN0aW9ucy5hdm9pZF9iYWNrc3RhYl9ib29sIG9yIG5vdCBjbGllbnQuY3VycmVudF90aHJlYXQoKSB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICAgICAgbG9jYWwgbHBfb3JpZ2luID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKQ0KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0X29yaWdpbiA9IHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihjbGllbnQuY3VycmVudF90aHJlYXQoKSkpDQoNCiAgICAgICAgICAgIGlmIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZldHlfb3B0aW9ucyksICJTdGF0aWMgb24gaGVpZ2h0IGFkdmFudGFnZSIpIGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuc3RhdGljX29uX2hlaWdodF9zdGF0ZXMpLCBsdWEudmFycy5pbnRfdG9fc3RyaW5nW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0pIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBscF9vcmlnaW4ueiA+IHRhcmdldF9vcmlnaW4ueiArIDExNSB0aGVuDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiTWluaW1hbCIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd19iYXNlLCAiQXQgdGFyZ2V0cyIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1sxXSwgIjE4MCIpDQogICAgICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnlhd1syXSwgMCkNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzFdLCAiT2ZmIikNCiAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5ib2R5eWF3WzJdLCAwKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCwNCg0KICAgICAgICBhdm9pZF9iYWNrc3RhYiA9IGZ1bmN0aW9uKCkNCg0KICAgICAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQNCiAgICANCiAgICAgICAgICAgIGlmIGFudGlhaW1fZnVuY3Rpb25zLm9udXNlX2FudGlhaW0gdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuc2FmZXR5X29wdGlvbnMpLCAiQXZvaWQgYmFja3N0YWIiKSB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgcGxheWVycyA9IGVudGl0eS5nZXRfcGxheWVycyh0cnVlKQ0KICAgICAgICAgICAgICAgIGZvciBfLCBwbGF5ZXIgaW4gaXBhaXJzKHBsYXllcnMpIGRvDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gdmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKTpkaXN0KHZlY3RvcihlbnRpdHkuZ2V0X29yaWdpbihwbGF5ZXIpKSkNCiAgICAgICAgICAgICAgICAgICAgaWYgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKHBsYXllcikpID09ICJDS25pZmUiIGFuZCBkaXN0YW5jZSA8PSAzMDAgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3WzJdLCAxODApDQogICAgICAgICAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy5waXRjaFsxXSwgIk9mZiIpDQogICAgICAgICAgICAgICAgICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5hdm9pZF9iYWNrc3RhYl9ib29sID0gdHJ1ZQ0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQsDQogICAgfSwNCg0KICAgIGxlZ2l0X2FudGlhaW0gPSBmdW5jdGlvbihjbWQpDQoNCiAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5vbnVzZV9hbnRpYWltID0gZmFsc2UNCg0KICAgICAgICBpZiB1aS5nZXQobWVudS5hbnRpYWltX3RhYi5vbnVzZV9hbnRpYWltX2hvdGtleSkgdGhlbg0KICAgICAgICAgICAgaWYgZW50aXR5LmdldF9jbGFzc25hbWUoZW50aXR5LmdldF9wbGF5ZXJfd2VhcG9uKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkpKSA9PSAiQ0M0IiB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICAgICAgbG9jYWwgYm9keV95YXdfbW9kZSA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0uYm9keXlhdykNCg0KICAgICAgICAgICAgbG9jYWwgc2hvdWxkX2Rpc2FibGUgPSBmYWxzZQ0KICAgICAgICAgICAgbG9jYWwgcGxhbnRlZF9ib21iID0gZW50aXR5LmdldF9hbGwoIkNQbGFudGVkQzQiKVsxXQ0KDQogICAgICAgICAgICBpZiBwbGFudGVkX2JvbWIgdGhlbg0KICAgICAgICAgICAgICAgIGxvY2FsIGJvbWJfZGlzdGFuY2UgPSB2ZWN0b3IoZW50aXR5LmdldF9vcmlnaW4oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpOmRpc3QodmVjdG9yKGVudGl0eS5nZXRfb3JpZ2luKHBsYW50ZWRfYm9tYikpKQ0KICAgICAgICAgICAgICAgIHNob3VsZF9kaXNhYmxlID0gYm9tYl9kaXN0YW5jZSA8PSA2NCBhbmQgZW50aXR5LmdldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2lUZWFtTnVtIikgPT0gMw0KICAgICAgICAgICAgZW5kDQoNCiAgICAgICAgICAgIGlmIG5vdCBzaG91bGRfZGlzYWJsZSB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgcGl0Y2gsIHlhdyA9IGNsaWVudC5jYW1lcmFfYW5nbGVzKCkNCiAgICAgICAgICAgICAgICBsb2NhbCBkaXJlY3RfdmVjID0gdmVjdG9yKGx1YS5mdW5jcy52ZWNfYW5nbGVzKHBpdGNoLCB5YXcpKQ0KICAgICAgICAgICAgICAgIGxvY2FsIGV5ZV9wb3MgPSB2ZWN0b3IoY2xpZW50LmV5ZV9wb3NpdGlvbigpKQ0KICAgICAgICAgICAgICAgIGxvY2FsIF8sIGVudCA9IGNsaWVudC50cmFjZV9saW5lKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksIGV5ZV9wb3MueCwgZXllX3Bvcy55LCBleWVfcG9zLnosIGV5ZV9wb3MueCArIChkaXJlY3RfdmVjLnggKiA4MTkyKSwgZXllX3Bvcy55ICsgKGRpcmVjdF92ZWMueSAqIDgxOTIpLCBleWVfcG9zLnogKyAoZGlyZWN0X3ZlYy56ICogODE5MikpDQoNCiAgICAgICAgICAgICAgICBpZiBlbnQgYW5kIGVudCB+PSAtMSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNsYXNzbmFtZSA9IGVudGl0eS5nZXRfY2xhc3NuYW1lKGVudCkNCiAgICAgICAgICAgICAgICAgICAgaWYgY2xhc3NuYW1lID09ICJDUHJvcERvb3JSb3RhdGluZyIgb3IgY2xhc3NuYW1lID09ICJDSG9zdGFnZSIgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgc2hvdWxkX2Rpc2FibGUgPSB0cnVlDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICANCg0KICAgICAgICAgICAgaWYgbm90IHNob3VsZF9kaXNhYmxlIHRoZW4NCiAgICAgICAgICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5vbnVzZV9hbnRpYWltID0gdHJ1ZQ0KICAgICAgICAgICAgICAgIHVpLnNldChyZWZzLnBpdGNoWzFdLCAiT2ZmIikNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDE4MCkNCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdqaXR0ZXJbMl0sIDApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMucm9sbCwgMCkNCiAgICAgICAgICAgICAgICBjbWQucm9sbCA9IDANCiAgICAgICAgICAgICAgICBpZiB1aS5nZXQobWVudS5hbnRpYWltX3RhYi5vbnVzZV9hbnRpYWltX21vZGUpID09ICJTdGF0aWMiIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgZGVzeW5jX2Z1bmN0aW9ucy5fcnVuKGNtZCwgdWkuZ2V0KG1lbnUuYW50aWFpbV90YWIub251c2VfYW50aWFpbV9zaWRlKSA9PSAiTGVmdCIgYW5kIC02MCBvciA2MCwgMCwgMCkNCiAgICAgICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgICAgIGRlc3luY19mdW5jdGlvbnMuX3J1bihjbWQsIGdsb2JhbHMudGlja2NvdW50KCkgJSA0ID49IDIgYW5kIC02MCBvciA2MCwgMCwgMCkNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KDQogICAgICAgICAgICBjbWQuaW5fdXNlID0gc2hvdWxkX2Rpc2FibGUgYW5kIDEgb3IgMA0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBmcmVlc3RhbmRpbmdfc2V0dXAgPSBmdW5jdGlvbigpDQoNCiAgICAgICAgY3VycmVudF9wbGF5ZXJfc3RhdGUgPSBsdWEudmFycy5pbnRfdG9fc3RyaW5nW2x1YS52YXJzLnBsYXllcl9zdGF0ZV0NCiAgICAgICAgY3VycmVudF9mcmVlc3RhbmRfZGlzYWJsZXJzID0gdWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuZnJlZXN0YW5kX2Rpc2FibGVycykNCg0KICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnMoY3VycmVudF9mcmVlc3RhbmRfZGlzYWJsZXJzLCBjdXJyZW50X3BsYXllcl9zdGF0ZSkgdGhlbg0KICAgICAgICAgICAgcmV0dXJuDQogICAgICAgIGVuZA0KDQogICAgICAgIGlmIHVpLmdldChtZW51LmFudGlhaW1fdGFiLmZyZWVzdGFuZF9ob3RrZXkpIHRoZW4NCiAgICAgICAgICAgIHVpLnNldChyZWZzLmJvZHl5YXdbMV0sICJPcHBvc2l0ZSIpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mcmVlc3RhbmRpbmdbMl0sICJBbHdheXMgb24iKQ0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZnJlZXN0YW5kaW5nWzFdLCB0cnVlKQ0KICAgICAgICAgICAgaWYgdWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuZnJlZXN0YW5kX21vZGUpID09ICJTdGF0aWMiIHRoZW4NCiAgICAgICAgICAgICAgICB1aS5zZXQocmVmcy55YXdbMl0sIDApDQogICAgICAgICAgICAgICAgdWkuc2V0KHJlZnMueWF3aml0dGVyWzJdLCAwKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmZyZWVzdGFuZGluZ1sxXSwgZmFsc2UpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5mcmVlc3RhbmRpbmdbMl0sICJPbiBob3RrZXkiKQ0KICAgICAgICBlbmQNCiAgICBlbmQsDQoNCiAgICBtYW51YWxfYW50aWFpbSA9IGZ1bmN0aW9uKCkNCg0KICAgICAgICBsb2NhbCBrZXliaW5kcyA9IHsNCiAgICAgICAgICAgIGZvcndhcmQgPSB1aS5nZXQobWVudS5hbnRpYWltX3RhYi5tYW51YWxfYW50aWFpbV9mb3J3YXJkKSwNCiAgICAgICAgICAgIGxlZnQgPSB1aS5nZXQobWVudS5hbnRpYWltX3RhYi5tYW51YWxfYW50aWFpbV9sZWZ0KSwNCiAgICAgICAgICAgIHJpZ2h0ID0gdWkuZ2V0KG1lbnUuYW50aWFpbV90YWIubWFudWFsX2FudGlhaW1fcmlnaHQpLA0KICAgICAgICB9DQogICAgDQogICAgICAgIGxvY2FsIGxhc3Rfa2V5YmluZHMgPSB7DQogICAgICAgICAgICBmb3J3YXJkID0gYW50aWFpbV9mdW5jdGlvbnMubWFudWFsX2FudGlhaW1fdGJsLmxhc3RfZm9yd2FyZCwNCiAgICAgICAgICAgIGxlZnQgPSBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9sZWZ0LA0KICAgICAgICAgICAgcmlnaHQgPSBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9yaWdodCwNCiAgICAgICAgfQ0KICAgIA0KICAgICAgICBsb2NhbCBrZXliaW5kX2lkeCA9IHsNCiAgICAgICAgICAgIGZvcndhcmQgPSAxLCANCiAgICAgICAgICAgIGxlZnQgPSAyLCANCiAgICAgICAgICAgIHJpZ2h0ID0gMw0KICAgICAgICB9DQogICAgDQogICAgICAgIGlmIGxhc3Rfa2V5YmluZHMuZm9yd2FyZCA9PSBuaWwgdGhlbg0KICAgICAgICAgICAgYW50aWFpbV9mdW5jdGlvbnMubWFudWFsX2FudGlhaW1fdGJsLmxhc3RfZm9yd2FyZCA9IGtleWJpbmRzLmZvcndhcmQNCiAgICAgICAgICAgIGFudGlhaW1fZnVuY3Rpb25zLm1hbnVhbF9hbnRpYWltX3RibC5sYXN0X2xlZnQgPSBrZXliaW5kcy5sZWZ0DQogICAgICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9yaWdodCA9IGtleWJpbmRzLnJpZ2h0DQogICAgICAgICAgICByZXR1cm4NCiAgICAgICAgZW5kDQogICAgDQogICAgICAgIGZvciBrZXksIHZhbHVlIGluIHBhaXJzKGtleWJpbmRzKSBkbw0KICAgICAgICAgICAgaWYgdmFsdWUgfj0gbGFzdF9rZXliaW5kc1trZXldIHRoZW4NCiAgICAgICAgICAgICAgICBpZiBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubWFudWFsX3NpZGUgPT0ga2V5YmluZF9pZHhba2V5XSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGFudGlhaW1fZnVuY3Rpb25zLm1hbnVhbF9hbnRpYWltX3RibC5tYW51YWxfc2lkZSA9IG5pbA0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgYW50aWFpbV9mdW5jdGlvbnMubWFudWFsX2FudGlhaW1fdGJsLm1hbnVhbF9zaWRlID0ga2V5YmluZF9pZHhba2V5XQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIA0KICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9mb3J3YXJkID0ga2V5YmluZHMuZm9yd2FyZA0KICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9sZWZ0ID0ga2V5YmluZHMubGVmdA0KICAgICAgICBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV90YmwubGFzdF9yaWdodCA9IGtleWJpbmRzLnJpZ2h0DQogICAgDQogICAgICAgIGxvY2FsIG1hbnVhbF9zaWRlID0gYW50aWFpbV9mdW5jdGlvbnMubWFudWFsX2FudGlhaW1fdGJsLm1hbnVhbF9zaWRlDQogICAgICAgIGlmIG1hbnVhbF9zaWRlIHRoZW4gYW50aWFpbV9mdW5jdGlvbnMubWFudWFsX2FudGlhaW1fYm9vbCA9IHRydWUgZWxzZSBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbV9ib29sID0gZmFsc2UgZW5kDQogICAgICAgIGlmIG5vdCBtYW51YWxfc2lkZSB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICB1aS5zZXQoDQogICAgICAgICAgICByZWZzLnlhd1syXSwNCiAgICAgICAgICAgIG1hbnVhbF9zaWRlID09IDEgYW5kDQogICAgICAgICAgICAgICAgKCh1aS5nZXQocmVmcy55YXdbMl0pICsgKHsxODAsIDkwLCAtOTB9KVttYW51YWxfc2lkZV0gKyAxODApICUgMzYwIC0gMTgwKQ0KICAgICAgICAgICAgb3INCiAgICAgICAgICAgICAgICAoKHVpLmdldChyZWZzLnlhd1syXSkgKyAoezE4MCwgOTAsIC05MH0pW21hbnVhbF9zaWRlXSkgJSAzNjAgLSAxODApDQogICAgICAgICAgICApDQogICAgZW5kLA0KDQogICAgZWRnZV95YXcgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIGVkZ2VfeWF3X3JlZiA9IHVpLmdldChtZW51LmFudGlhaW1fdGFiLmVkZ2VfeWF3KQ0KDQogICAgICAgIGlmIGVkZ2VfeWF3X3JlZiBhbmQgbm90IGFudGlhaW1fZnVuY3Rpb25zLm1hbnVhbF9hbnRpYWltX2Jvb2wgdGhlbg0KICAgICAgICAgICAgdWkuc2V0KHJlZnMuZWRnZV95YXcsIHRydWUpDQogICAgICAgIGVsc2UNCiAgICAgICAgICAgIHVpLnNldChyZWZzLmVkZ2VfeWF3LCBmYWxzZSkNCiAgICAgICAgZW5kDQogICAgZW5kLA0KfQ0KDQp2aXN1YWxfZnVuY3Rpb25zID0ge30NCg0KdmlzdWFsX2Z1bmN0aW9ucyA9IHsNCg0KICAgIGxlZ3NfY2FjaGVkID0gZmFsc2UsDQogICAgZ3JvdW5kX3RpY2tzID0gMCwNCg0KICAgIGRhbWFnZV9pbmRpY2F0b3IgPSBmdW5jdGlvbigpDQoNCiAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBfeCwgX3kgPSBjbGllbnQuc2NyZWVuX3NpemUoKQ0KICAgICAgICBsb2NhbCBtaW5fZGFtYWdlX2luZGljYXRvciA9IHVpLmdldChtZW51Lm1pc2NfdGFiLm1pbmltdW1fZGFtYWdlX2luZGljYXRvcikNCiAgICAgICAgbG9jYWwgcGxheWVyX3dlYXBvbl9jbGFzc25hbWUgPSBlbnRpdHkuZ2V0X2NsYXNzbmFtZShlbnRpdHkuZ2V0X3BsYXllcl93ZWFwb24oZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSkpDQoNCiAgICAgICAgbG9jYWwgZ3JlbmFkZV9hbmRfa25pZmVfY2xhc3NlcyA9IHsNCiAgICAgICAgICAgIENIRUdyZW5hZGUgPSB0cnVlLA0KICAgICAgICAgICAgQ1Ntb2tlR3JlbmFkZSA9IHRydWUsDQogICAgICAgICAgICBDTW9sb3RvdkdyZW5hZGUgPSB0cnVlLA0KICAgICAgICAgICAgQ0ZsYXNoYmFuZyA9IHRydWUsDQogICAgICAgICAgICBDRGVjb3lHcmVuYWRlID0gdHJ1ZSwNCiAgICAgICAgICAgIENLbmlmZSA9IHRydWUsDQogICAgICAgICAgICBDV2VhcG9uVGFzZXIgPSB0cnVlDQogICAgICAgIH0NCiAgICAgICAgDQogICAgICAgIGlmIG1pbl9kYW1hZ2VfaW5kaWNhdG9yID09ICJPZmYiIG9yIGdyZW5hZGVfYW5kX2tuaWZlX2NsYXNzZXNbcGxheWVyX3dlYXBvbl9jbGFzc25hbWVdIHRoZW4NCiAgICAgICAgICAgIHJldHVybg0KICAgICAgICBlbmQNCiAgICAgICAgDQogICAgICAgIGxvY2FsIGRhbWFnZV9vdmVycmlkZV9hY3RpdmUgPSB1aS5nZXQocmVmcy5kYW1hZ2Vfb3ZlcnJpZGVbMV0pIGFuZCB1aS5nZXQocmVmcy5kYW1hZ2Vfb3ZlcnJpZGVbMl0pDQogICAgICAgIGxvY2FsIGRhbWFnZV9zdHJpbmcgPSBtaW5fZGFtYWdlX2luZGljYXRvciA9PSAiQWx3YXlzIiBhbmQgKGRhbWFnZV9vdmVycmlkZV9hY3RpdmUgYW5kIHVpLmdldChyZWZzLmRhbWFnZV9vdmVycmlkZVszXSkgb3IgdWkuZ2V0KHJlZnMuZGFtYWdlWzFdKSkNCiAgICAgICAgICAgICAgICBvciAobWluX2RhbWFnZV9pbmRpY2F0b3IgPT0gIk9uIG92ZXJyaWRlIiBhbmQgZGFtYWdlX292ZXJyaWRlX2FjdGl2ZSBhbmQgdWkuZ2V0KHJlZnMuZGFtYWdlX292ZXJyaWRlWzNdKSBvciBub3JtYWxpemUpDQoNCiAgICAgICAgaWYgZGFtYWdlX3N0cmluZyB+PSBuaWwgdGhlbg0KICAgICAgICAgICAgcmVuZGVyZXIudGV4dChfeCAvIDIgKyA1LCBfeSAvIDIgLSAyMCwgMjU1LCAyNTUsIDI1NSwgMjU1LCAiIiwgMCwgdG9zdHJpbmcoZGFtYWdlX3N0cmluZykpDQogICAgICAgIGVuZA0KICAgIGVuZCwNCg0KICAgIGFuaW1fYnJlYWtlcnMgPSBmdW5jdGlvbigpDQoNCiAgICAgICAgaWYgbm90IGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCkgb3Igbm90IGVudGl0eS5pc19hbGl2ZShlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpKSB0aGVuIHJldHVybiBlbmQNCg0KICAgICAgICBsb2NhbCBmbGFncyA9IGVudGl0eS5nZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mRmxhZ3MiKQ0KICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmdyb3VuZF90aWNrcyA9IGJpdC5iYW5kKGZsYWdzLCAxKSA9PSAwIGFuZCAwIG9yICh2aXN1YWxfZnVuY3Rpb25zLmdyb3VuZF90aWNrcyA8IDUgYW5kIHZpc3VhbF9mdW5jdGlvbnMuZ3JvdW5kX3RpY2tzICsgMSBvciB2aXN1YWxfZnVuY3Rpb25zLmdyb3VuZF90aWNrcykNCg0KICAgICAgICBsb2NhbCBhbmltYXRpb25zID0gdWkuZ2V0KG1lbnUubWlzY190YWIuYW5pbWF0aW9ucykNCg0KICAgICAgICBpZiBsdWEuZnVuY3MudGFibGVfY29udGFpbnMoYW5pbWF0aW9ucywgIlN0YXRpYyBsZWdzIikgdGhlbg0KICAgICAgICAgICAgZW50aXR5LnNldF9wcm9wKGVudGl0eS5nZXRfbG9jYWxfcGxheWVyKCksICJtX2ZsUG9zZVBhcmFtZXRlciIsIDEsIDYpDQogICAgICAgIGVuZA0KDQogICAgICAgIGlmIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyhhbmltYXRpb25zLCAiTGVnIGZ1Y2tlciIpIHRoZW4NCiAgICAgICAgICAgIGlmIG5vdCB2aXN1YWxfZnVuY3Rpb25zLmxlZ3NfY2FjaGVkIHRoZW4NCiAgICAgICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmxlZ3NfY2FjaGVkID0gdWkuZ2V0KHJlZnMubGVnX21vdmVtZW50KQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShyZWZzLmxlZ19tb3ZlbWVudCwgZmFsc2UpDQogICAgICAgICAgICBpZiBnbG9iYWxzLnRpY2tjb3VudCgpICUgNCA8PSAxIHRoZW4NCiAgICAgICAgICAgICAgICBlbnRpdHkuc2V0X3Byb3AoZW50aXR5LmdldF9sb2NhbF9wbGF5ZXIoKSwgIm1fZmxQb3NlUGFyYW1ldGVyIiwgMCwgMCkNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgdWkuc2V0KHJlZnMubGVnX21vdmVtZW50LCAiQWx3YXlzIHNsaWRlIikNCiAgICAgICAgZWxzZWlmIHZpc3VhbF9mdW5jdGlvbnMubGVnc19jYWNoZWQgdGhlbg0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUocmVmcy5sZWdfbW92ZW1lbnQsIHRydWUpDQogICAgICAgICAgICB1aS5zZXQocmVmcy5sZWdfbW92ZW1lbnQsIHZpc3VhbF9mdW5jdGlvbnMubGVnc19jYWNoZWQpDQogICAgICAgICAgICB2aXN1YWxfZnVuY3Rpb25zLmxlZ3NfY2FjaGVkID0gZmFsc2UNCiAgICAgICAgZW5kDQoNCiAgICAgICAgaWYgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51Lm1pc2NfdGFiLmFuaW1hdGlvbnMpLCAiMCBwaXRjaCBvbiBsYW5kaW5nIikgdGhlbg0KICAgICAgICAgICAgdmlzdWFsX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPSBiaXQuYmFuZChmbGFncywgMSkgPT0gMSBhbmQgdmlzdWFsX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgKyAxIG9yIDANCg0KICAgICAgICAgICAgaWYgdmlzdWFsX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPiAyNSBhbmQgdmlzdWFsX2Z1bmN0aW9ucy5ncm91bmRfdGlja3MgPCAyMjUgdGhlbg0KICAgICAgICAgICAgICAgIGVudGl0eS5zZXRfcHJvcChlbnRpdHkuZ2V0X2xvY2FsX3BsYXllcigpLCAibV9mbFBvc2VQYXJhbWV0ZXIiLCAwLjUsIDEyKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCwNCg0KICAgIHJlbmRlcl93YXRlcm1hcmsgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIHdpZHRoLCBoZWlnaHQgPSBjbGllbnQuc2NyZWVuX3NpemUoKQ0KDQogICAgICAgIHdhdGVybWFya19jb2xvcl9hcnJheSA9IGx1YS5mdW5jcy5jcmVhdGVfY29sb3JfYXJyYXkobHVhX2NvbG9yWzFdLCBsdWFfY29sb3JbMl0sIGx1YV9jb2xvclszXSwgImVwaGVtZXJhbCBbcmVib3JuXSIpDQogICAgICAgIGNvbG9yX2FycmF5X3N0cmluZyA9IHN0cmluZy5mb3JtYXQoIlxhJXNlXGElc3BcYSVzaFxhJXNlXGElc21cYSVzZVxhJXNyXGElc2FcYSVzbCBbcmVib3JuXSIsIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzFdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzJdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzNdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzRdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzVdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzZdKSksICBsdWEuZnVuY3MucmdiYV9oZXgodW5wYWNrKHdhdGVybWFya19jb2xvcl9hcnJheVs3XSkpLCAgbHVhLmZ1bmNzLnJnYmFfaGV4KHVucGFjayh3YXRlcm1hcmtfY29sb3JfYXJyYXlbOF0pKSwgIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sod2F0ZXJtYXJrX2NvbG9yX2FycmF5WzldKSkgKSAuLiBsdWEuZnVuY3MuaGV4KHtsdWFfY29sb3JbMV0sIGx1YV9jb2xvclsyXSwgbHVhX2NvbG9yWzNdfSkNCg0KICAgICAgICByZW5kZXJlci50ZXh0KHdpZHRoIC8gMiAtIHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgibyIsICJlcGhlbWVyYWwgW3JlYm9ybl0iKSAvIDIsIGhlaWdodCAtIDI2LCAyMjAsIDIyMCwgMjIwLCAyNTUsICJvIiwgMCwgY29sb3JfYXJyYXlfc3RyaW5nKQ0KICAgICAgICByZW5kZXJlci50ZXh0KHdpZHRoIC8gMiAtIHJlbmRlcmVyLm1lYXN1cmVfdGV4dCgibyIsICJkc2MuZ2cvZXBoZW1lcmFsLWx1YSIpIC8gMiwgaGVpZ2h0IC0gMTUsIGx1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM10sIDI1NSwgIm8iLCAwLCAiZHNjLmdnL2VwaGVtZXJhbC1sdWEiKQ0KICAgIGVuZCwNCn0NCg0KdWkudXBkYXRlKG1lbnUuY29uZmlndXJhdGlvbl90YWIubGlzdCwgY29uZmlnX3N5c3RlbS5sb2FkX2NvbmZpZ19saXN0KCkpDQoNCmlmIGRhdGFiYXNlLnJlYWQobHVhLmRhdGFiYXNlLmNvbmZpZ3MpID09IG5pbCB0aGVuDQogICAgZGF0YWJhc2Uud3JpdGUobHVhLmRhdGFiYXNlLmNvbmZpZ3MsIHt9KQ0KZW5kDQoNCnVpLnNldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUsICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSA9PSAwIGFuZCAiIiBvciBkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKVt1aS5nZXQobWVudS5jb25maWd1cmF0aW9uX3RhYi5saXN0KSsxXS5uYW1lKQ0KdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlndXJhdGlvbl90YWIubGlzdCwgZnVuY3Rpb24odmFsdWUpDQogICAgbG9jYWwgcHJvdGVjdGVkID0gZnVuY3Rpb24oKQ0KICAgICAgICBpZiB2YWx1ZSA9PSBuaWwgdGhlbiByZXR1cm4gZW5kDQogICAgICAgIGxvY2FsIG5hbWUgPSAiIg0KICAgIA0KICAgICAgICBsb2NhbCBjb25maWdzID0gY29uZmlnX3N5c3RlbS5sb2FkX2NvbmZpZ19saXN0KCkNCiAgICAgICAgaWYgY29uZmlncyA9PSBuaWwgdGhlbiByZXR1cm4gZW5kDQogICAgDQogICAgICAgIG5hbWUgPSBjb25maWdzW3VpLmdldCh2YWx1ZSkrMV0gb3IgIiINCiAgICANCiAgICAgICAgdWkuc2V0KG1lbnUuY29uZmlndXJhdGlvbl90YWIubmFtZSwgbmFtZSkNCiAgICBlbmQNCg0KICAgIGlmIHBjYWxsKHByb3RlY3RlZCkgdGhlbg0KDQogICAgZW5kDQplbmQpDQoNCnVpLnNldF9jYWxsYmFjayhtZW51LmNvbmZpZ3VyYXRpb25fdGFiLmxvYWQsIGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBuYW1lID0gdWkuZ2V0KG1lbnUuY29uZmlndXJhdGlvbl90YWIubmFtZSkNCiAgICBpZiBuYW1lID09ICIiIHRoZW4gcmV0dXJuIGVuZA0KICAgIGxvY2FsIHByb3RlY3RlZCA9IGZ1bmN0aW9uKCkNCiAgICAgICAgY29uZmlnX3N5c3RlbS5sb2FkX2NvbmZpZyhuYW1lKQ0KICAgIGVuZA0KDQogICAgbG9jYWwgc3RhdHVzLCBlcnIgPSBwY2FsbChwcm90ZWN0ZWQpDQoNCiAgICBpZiBzdGF0dXMgdGhlbg0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICJTdWNjZXNzZnVsbHkgbG9hZGVkIHNldHRpbmdzIFwwIikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhsdWFfY29sb3JbMV0sIGx1YV9jb2xvclsyXSwgbHVhX2NvbG9yWzNdLCBuYW1lKQ0KICAgIGVsc2UNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDAsIDAsICJGYWlsZWQgdG8gbG9hZCBzZXR0aW5ncyBcMCIpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cobHVhX2NvbG9yWzFdLCBsdWFfY29sb3JbMl0sIGx1YV9jb2xvclszXSwgbmFtZSAuLiAiXDAgOiAiKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMCwgMCwgZXJyKQ0KICAgIGVuZA0KZW5kKQ0KDQp1aS5zZXRfY2FsbGJhY2sobWVudS5jb25maWd1cmF0aW9uX3RhYi5zYXZlLCBmdW5jdGlvbigpDQogICAgbG9jYWwgbmFtZSA9IHVpLmdldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUpDQogICAgaWYgbmFtZSA9PSAiIiB0aGVuIHJldHVybiBlbmQNCg0KICAgIGxvY2FsIHByb3RlY3RlZCA9IGZ1bmN0aW9uKCkNCiAgICAgICAgY29uZmlnX3N5c3RlbS5zYXZlX2NvbmZpZyhuYW1lKQ0KICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWd1cmF0aW9uX3RhYi5saXN0LCBjb25maWdfc3lzdGVtLmxvYWRfY29uZmlnX2xpc3QoKSkNCiAgICBlbmQNCg0KICAgIHN0YXR1cywgZXJyID0gcGNhbGwocHJvdGVjdGVkKQ0KDQogICAgaWYgc3RhdHVzIHRoZW4NCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiU3VjY2Vzc2Z1bGx5IHNhdmVkIHNldHRpbmdzIGZvciBcMCIpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cobHVhX2NvbG9yWzFdLCBsdWFfY29sb3JbMl0sIGx1YV9jb2xvclszXSwgbmFtZSkNCiAgICBlbHNlDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAwLCAwLCAiRmFpbGVkIHRvIHNhdmUgc2V0dGluZ3MgZm9yIFwwIikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhsdWFfY29sb3JbMV0sIGx1YV9jb2xvclsyXSwgbHVhX2NvbG9yWzNdLCBuYW1lIC4uICJcMCA6IikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDAsIDAsIGVycikNCiAgICBlbmQNCmVuZCkNCg0KdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlndXJhdGlvbl90YWIuZGVsZXRlLCBmdW5jdGlvbigpDQogICAgbG9jYWwgbmFtZSA9IHVpLmdldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUpDQogICAgaWYgbmFtZSA9PSAiIiB0aGVuIHJldHVybiBlbmQNCiAgICBpZiBjb25maWdfc3lzdGVtLmRlbGV0ZV9jb25maWcobmFtZSkgPT0gZmFsc2UgdGhlbg0KICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWd1cmF0aW9uX3RhYi5saXN0LCBjb25maWdfc3lzdGVtLmxvYWRfY29uZmlnX2xpc3QoKSkNCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICBsb2NhbCBwcm90ZWN0ZWQgPSBmdW5jdGlvbigpDQogICAgICAgIGNvbmZpZ19zeXN0ZW0uZGVsZXRlX2NvbmZpZyhuYW1lKQ0KICAgIGVuZA0KDQogICAgc3RhdHVzLCBlcnIgPSBwY2FsbChwcm90ZWN0ZWQpDQoNCiAgICBpZiBzdGF0dXMgdGhlbg0KICAgICAgICB1aS51cGRhdGUobWVudS5jb25maWd1cmF0aW9uX3RhYi5saXN0LCBjb25maWdfc3lzdGVtLmxvYWRfY29uZmlnX2xpc3QoKSkNCiAgICAgICAgdWkuc2V0KG1lbnUuY29uZmlndXJhdGlvbl90YWIubGlzdCwgI3ByZXNldHMgKyAjZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykgLSAjZGF0YWJhc2UucmVhZChsdWEuZGF0YWJhc2UuY29uZmlncykpDQogICAgICAgIHVpLnNldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUsICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSA9PSAwIGFuZCAiIiBvciBjb25maWdfc3lzdGVtLmxvYWRfY29uZmlnX2xpc3QoKVsjcHJlc2V0cyArICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSAtICNkYXRhYmFzZS5yZWFkKGx1YS5kYXRhYmFzZS5jb25maWdzKSsxXSkNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDI1NSwgMjU1LCAiU3VjY2Vzc2Z1bGx5IGRlbGV0ZWQgXDAiKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKGx1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM10sIG5hbWUpDQogICAgZWxzZQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMCwgMCwgIkZhaWxlZCB0byBkZWxldGUgXDAiKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKGx1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM10sIG5hbWUgLi4gIlwwIDogIikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDAsIDAsIGVycikNCiAgICBlbmQNCmVuZCkNCg0KdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlndXJhdGlvbl90YWIuaW1wb3J0LCBmdW5jdGlvbigpDQogICAgbG9jYWwgcHJvdGVjdGVkID0gZnVuY3Rpb24oKQ0KICAgICAgICBjb25maWdfc3lzdGVtLmltcG9ydF9zZXR0aW5ncygpDQogICAgZW5kDQoNCiAgICBsb2NhbCBzdGF0dXMsIGVyciA9IHBjYWxsKHByb3RlY3RlZCkNCiAgICANCiAgICBpZiBzdGF0dXMgdGhlbg0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICJTdWNjZXNzZnVsbHkgaW1wb3J0ZWQgc2V0dGluZ3MiKQ0KICAgIGVsc2UNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZygyNTUsIDAsIDAsICJGYWlsZWQgdG8gaW1wb3J0IHNldHRpbmdzOiAiLCBlcnIpDQogICAgZW5kDQplbmQpDQoNCg0KdWkuc2V0X2NhbGxiYWNrKG1lbnUuY29uZmlndXJhdGlvbl90YWIuZXhwb3J0LCBmdW5jdGlvbigpDQogICAgbG9jYWwgbmFtZSA9IHVpLmdldChtZW51LmNvbmZpZ3VyYXRpb25fdGFiLm5hbWUpDQogICAgaWYgbmFtZSA9PSAiIiB0aGVuIHJldHVybiBlbmQNCg0KICAgIGxvY2FsIHByb3RlY3RlZCA9IGZ1bmN0aW9uKCkNCiAgICAgICAgY29uZmlnX3N5c3RlbS5leHBvcnRfc2V0dGluZ3MobmFtZSkNCiAgICBlbmQNCg0KICAgIGlmIHBjYWxsKHByb3RlY3RlZCkgdGhlbg0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMjU1LCAyNTUsICJTdWNjZXNzZnVsbHkgZXhwb3J0ZWQgc2V0dGluZ3MgZnJvbSBcMCIpDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2cobHVhX2NvbG9yWzFdLCBsdWFfY29sb3JbMl0sIGx1YV9jb2xvclszXSwgbmFtZSkNCiAgICBlbHNlDQogICAgICAgIGNsaWVudC5jb2xvcl9sb2coMjU1LCAwLCAwLCAiRmFpbGVkIHRvIGV4cG9ydCBzZXR0aW5ncyBmcm9tIFwwIikNCiAgICAgICAgY2xpZW50LmNvbG9yX2xvZyhsdWFfY29sb3JbMV0sIGx1YV9jb2xvclsyXSwgbHVhX2NvbG9yWzNdLCAgbmFtZSAuLiAiXDAgOiAiKQ0KICAgICAgICBjbGllbnQuY29sb3JfbG9nKDI1NSwgMCwgMCwgZXJyKQ0KICAgIGVuZA0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJwYWludF91aSIsIGZ1bmN0aW9uKCkNCiAgICBsdWEudmFycy5hY3RpdmVfc3RhdGUgPSBsdWEudmFycy5zdHJpbmdfdG9faW50W3VpLmdldChtZW51LmFudGlhaW1fYnVpbGRlcl90YWIuc3RhdGUpXQ0KDQogICAgdWkuc2V0X3Zpc2libGUodGFiX3NlbGVjdGlvbiwgdHJ1ZSkNCiAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX3RhYnMsIHVpLmdldCh0YWJfc2VsZWN0aW9uKSA9PSAiQW50aS1haW0iKQ0KICAgIGlzX2FudGlhaW1fdGFiID0gdWkuZ2V0KHRhYl9zZWxlY3Rpb24pID09ICJBbnRpLWFpbSIgYW5kIHVpLmdldChhbnRpYWltX3RhYnMpID09ICJLZXliaW5kcyINCiAgICBpc19hbnRpYWltX2J1aWxkZXJfdGFiID0gdWkuZ2V0KHRhYl9zZWxlY3Rpb24pID09ICJBbnRpLWFpbSIgYW5kIHVpLmdldChhbnRpYWltX3RhYnMpID09ICJCdWlsZGVyIg0KICAgIGlzX21pc2NfdGFiID0gdWkuZ2V0KHRhYl9zZWxlY3Rpb24pID09ICJNaXNjIg0KICAgIGlzX2NvbmZpZ190YWIgPSB1aS5nZXQodGFiX3NlbGVjdGlvbikgPT0gIkNvbmZpZyINCg0KICAgIG5hbWVfY29sb3JfYXJyYXkgPSBsdWEuZnVuY3MuY3JlYXRlX2NvbG9yX2FycmF5KGx1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM10sICJFcGhlbWVyYWwgW1JlYm9ybl0iKQ0KICAgIHVpLnNldChsYWJlbCwgc3RyaW5nLmZvcm1hdCgiXGElc0VcYSVzcFxhJXNoXGElc2VcYSVzbVxhJXNlXGElc3JcYSVzYVxhJXNsIFtSZWJvcm5dIiwgbHVhLmZ1bmNzLnJnYmFfaGV4KHVucGFjayhuYW1lX2NvbG9yX2FycmF5WzFdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sobmFtZV9jb2xvcl9hcnJheVsyXSkpLCBsdWEuZnVuY3MucmdiYV9oZXgodW5wYWNrKG5hbWVfY29sb3JfYXJyYXlbM10pKSwgbHVhLmZ1bmNzLnJnYmFfaGV4KHVucGFjayhuYW1lX2NvbG9yX2FycmF5WzRdKSksIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sobmFtZV9jb2xvcl9hcnJheVs1XSkpLCBsdWEuZnVuY3MucmdiYV9oZXgodW5wYWNrKG5hbWVfY29sb3JfYXJyYXlbNl0pKSwgIGx1YS5mdW5jcy5yZ2JhX2hleCh1bnBhY2sobmFtZV9jb2xvcl9hcnJheVs3XSkpLCAgbHVhLmZ1bmNzLnJnYmFfaGV4KHVucGFjayhuYW1lX2NvbG9yX2FycmF5WzhdKSksICBsdWEuZnVuY3MucmdiYV9oZXgodW5wYWNrKG5hbWVfY29sb3JfYXJyYXlbOV0pKSApIC4uIGx1YS5mdW5jcy5oZXgoe2x1YV9jb2xvclsxXSwgbHVhX2NvbG9yWzJdLCBsdWFfY29sb3JbM119KSkNCg0KICAgIHVpLnNldChhbnRpYWltX2J1aWxkZXJfdGJsWzFdLmVuYWJsZV9zdGF0ZSwgdHJ1ZSkNCg0KICAgIGZvciBpID0gMSwgI2x1YS52YXJzLnBsYXllcl9zdGF0ZXMgZG8NCiAgICAgICAgbG9jYWwgc3RhdGVfZW5hYmxlZCA9IHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmVuYWJsZV9zdGF0ZSkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5lbmFibGVfc3RhdGUsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpfj0xIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLnN0YXRlX2Rpc2FibGVycywgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IDkgYW5kIGkgPT0gOSBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbOV0uZW5hYmxlX3N0YXRlKSkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5waXRjaCwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0ucGl0Y2hfc2xpZGVyICwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLnBpdGNoKSA9PSAiQ3VzdG9tIikNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS55YXdfYmFzZSwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0ueWF3LCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS55YXdfc3RhdGljLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0ueWF3KSA9PSAiU3RhdGljIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS55YXdfbGVmdCwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLnlhdykgPT0gIkwmUiIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0ueWF3X3JpZ2h0LCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0ueWF3KSA9PSAiTCZSIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS55YXdqaXR0ZXIsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLnlhd2ppdHRlcl9yYW5kb20sIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS55YXdqaXR0ZXIpID09ICJSYW5kb20iIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmJvZHl5YXcsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmZha2VfbGltaXQsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5ib2R5eWF3KSA9PSAiU3RhdGljIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5mYWtlX2xpbWl0X2xlZnQsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5ib2R5eWF3KSA9PSAiSml0dGVyIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5mYWtlX2xpbWl0X3JpZ2h0LCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uYm9keXlhdykgPT0gIkppdHRlciIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZmFrZV9saW1pdF9sZWZ0X2RlbGF5ZWQsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5ib2R5eWF3KSA9PSAiRGVsYXllZCBKaXR0ZXIiIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmZha2VfbGltaXRfcmlnaHRfZGVsYXllZCwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmJvZHl5YXcpID09ICJEZWxheWVkIEppdHRlciIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZmFrZV9saW1pdF9kZWxheV90aWNrcywgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmJvZHl5YXcpID09ICJEZWxheWVkIEppdHRlciIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZm9yY2VfZGVmZW5zaXZlX2V4cGxvaXQsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV9waXRjaF9vcHRpb25zLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKSwgIlBpdGNoIikgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3BpdGNoX2ZsaWNrX2RlZ3JlZTEsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfYW50aWFpbV9zZWxlY3Rpb24pLCAiUGl0Y2giKSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3BpdGNoX29wdGlvbnMpID09ICJGbGljayIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3BpdGNoX2ZsaWNrX2RlZ3JlZTIsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfYW50aWFpbV9zZWxlY3Rpb24pLCAiUGl0Y2giKSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3BpdGNoX29wdGlvbnMpID09ICJGbGljayIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3BpdGNoX2N1c3RvbSwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIGkgfj0gOSBhbmQgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV9hbnRpYWltX3NlbGVjdGlvbiksICJQaXRjaCIpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfcGl0Y2hfb3B0aW9ucykgPT0gIkN1c3RvbSIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3lhd19vcHRpb25zLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKSwgIllhdyIpIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfZmxpY2tfYW5nbGUxLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKSwgIllhdyIpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfeWF3X29wdGlvbnMpID09ICJGbGljayIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3lhd19mbGlja19hbmdsZTIsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfYW50aWFpbV9zZWxlY3Rpb24pLCAiWWF3IikgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfb3B0aW9ucykgPT0gIkZsaWNrIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfeWF3X3NwaW5fcmFuZ2UsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfYW50aWFpbV9zZWxlY3Rpb24pLCAiWWF3IikgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfb3B0aW9ucykgPT0gIlNwaW4iIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfc3Bpbl9zcGVlZCwgbHVhLnZhcnMuYWN0aXZlX3N0YXRlID09IGkgYW5kIGkgfj0gOSBhbmQgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV9hbnRpYWltX3NlbGVjdGlvbiksICJZYXciKSBhbmQgdWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3lhd19vcHRpb25zKSA9PSAiU3BpbiIgYW5kIGlzX2FudGlhaW1fYnVpbGRlcl90YWIgYW5kIHN0YXRlX2VuYWJsZWQpDQogICAgICAgIHVpLnNldF92aXNpYmxlKGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX3lhd19kaXN0b3J0aW9uX3JhbmdlLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKSwgIllhdyIpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfeWF3X29wdGlvbnMpID09ICJEaXN0b3J0aW9uIiBhbmQgaXNfYW50aWFpbV9idWlsZGVyX3RhYiBhbmQgc3RhdGVfZW5hYmxlZCkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfeWF3X2Rpc3RvcnRpb25fc3BlZWQsIGx1YS52YXJzLmFjdGl2ZV9zdGF0ZSA9PSBpIGFuZCBpIH49IDkgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfYW50aWFpbV9zZWxlY3Rpb24pLCAiWWF3IikgYW5kIHVpLmdldChhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfb3B0aW9ucykgPT0gIkRpc3RvcnRpb24iIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgICAgICB1aS5zZXRfdmlzaWJsZShhbnRpYWltX2J1aWxkZXJfdGJsW2ldLmRlZmVuc2l2ZV95YXdfcmFuZG9tX3JhbmdlLCBsdWEudmFycy5hY3RpdmVfc3RhdGUgPT0gaSBhbmQgaSB+PSA5IGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KGFudGlhaW1fYnVpbGRlcl90YmxbaV0uZGVmZW5zaXZlX2FudGlhaW1fc2VsZWN0aW9uKSwgIllhdyIpIGFuZCB1aS5nZXQoYW50aWFpbV9idWlsZGVyX3RibFtpXS5kZWZlbnNpdmVfeWF3X29wdGlvbnMpID09ICJSYW5kb20iIGFuZCBpc19hbnRpYWltX2J1aWxkZXJfdGFiIGFuZCBzdGF0ZV9lbmFibGVkKQ0KICAgIGVuZA0KDQogICAgZm9yIGksIGZlYXR1cmUgaW4gcGFpcnMobWVudS5hbnRpYWltX3RhYikgZG8NCg0KICAgICAgICB1aS5zZXRfdmlzaWJsZSg0MSwgaXNfYW50aWFpbV90YWIgYW5kIGx1YS5mdW5jcy50YWJsZV9jb250YWlucyh1aS5nZXQobWVudS5hbnRpYWltX3RhYi5zYWZldHlfb3B0aW9ucyksICJSYW5kb20gYW50aS1haW0iKSkNCiAgICAgICAgdWkuc2V0X3Zpc2libGUoNDIsIGlzX2FudGlhaW1fdGFiIGFuZCBsdWEuZnVuY3MudGFibGVfY29udGFpbnModWkuZ2V0KG1lbnUuYW50aWFpbV90YWIuc2FmZXR5X29wdGlvbnMpLCAiU2FmZSBoZWFkIikpDQogICAgICAgIHVpLnNldF92aXNpYmxlKDQzLCBpc19hbnRpYWltX3RhYiBhbmQgbHVhLmZ1bmNzLnRhYmxlX2NvbnRhaW5zKHVpLmdldChtZW51LmFudGlhaW1fdGFiLnNhZmV0eV9vcHRpb25zKSwgIlN0YXRpYyBvbiBoZWlnaHQgYWR2YW50YWdlIikpDQogICAgICAgIHVpLnNldF92aXNpYmxlKDQ2LCBpc19hbnRpYWltX3RhYiBhbmQgdWkuZ2V0KG1lbnUuYW50aWFpbV90YWIub251c2VfYW50aWFpbV9tb2RlKSA9PSAiU3RhdGljIikNCg0KICAgICAgICBpZiB0eXBlKGZlYXR1cmUpIH49ICJ0YWJsZSIgdGhlbg0KICAgICAgICAgICAgdWkuc2V0X3Zpc2libGUoZmVhdHVyZSwgaXNfYW50aWFpbV90YWIpDQogICAgICAgIGVuZA0KCWVuZCANCg0KICAgIGZvciBpLCBmZWF0dXJlIGluIHBhaXJzKG1lbnUuYW50aWFpbV9idWlsZGVyX3RhYikgZG8NCgkJdWkuc2V0X3Zpc2libGUoZmVhdHVyZSwgaXNfYW50aWFpbV9idWlsZGVyX3RhYikNCgllbmQNCg0KICAgIGZvciBpLCBmZWF0dXJlIGluIHBhaXJzKG1lbnUubWlzY190YWIpIGRvDQogICAgICAgIGlmIHR5cGUoZmVhdHVyZSkgfj0gInRhYmxlIiB0aGVuDQogICAgICAgICAgICB1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc19taXNjX3RhYikNCiAgICAgICAgZW5kDQoJZW5kDQoNCiAgICBmb3IgaSwgZmVhdHVyZSBpbiBwYWlycyhtZW51LmNvbmZpZ3VyYXRpb25fdGFiKSBkbw0KCQl1aS5zZXRfdmlzaWJsZShmZWF0dXJlLCBpc19jb25maWdfdGFiKQ0KCWVuZA0KDQogICAgbHVhLmZ1bmNzLnJlc2V0X2FudGlhaW1fdGFiKGZhbHNlKQ0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJzZXR1cF9jb21tYW5kIiwgZnVuY3Rpb24oY21kKQ0KDQogICAgY2xpZW50LmV4ZWMoInN2X21heHVubGFnIDAuMTc1IikNCiAgICBjbGllbnQuZXhlYygiZnBzX21heCAwIikNCiAgICBjbGllbnQuZXhlYygiZnBzX21heF9tZW51IDAiKQ0KDQogICAgdWkuc2V0KHJlZnMuZGVsYXlfc2hvdCwgdWkuZ2V0KGFudGlhaW1fZnVuY3Rpb25zLmRlbGF5X3Nob3QpKQ0KDQogICAgYW50aWFpbV9mdW5jdGlvbnMuYW50aWFpbV9zdGF0ZShjbWQpDQogICAgYW50aWFpbV9mdW5jdGlvbnMuYW50aWFpbV9oYW5kbGUoY21kKQ0KICAgIGFudGlhaW1fZnVuY3Rpb25zLmZhc3RfbGFkZGVyKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5yYW5kb21fYWFfb25fd2FybXVwKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5yYW5kb21fYWFfb25fZnJlZXplKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5yYW5kb21fYWFfb25fcm91bmRfZW5kKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5zYWZlX2tuaWZlKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5zYWZlX2hlYWQoY21kKQ0KICAgIGFudGlhaW1fZnVuY3Rpb25zLnNhZmV0eV9vcHRpb25zLnN0YXRpY19vbl9oZWlnaHRfYWR2YW50YWdlKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5zYWZldHlfb3B0aW9ucy5hdm9pZF9iYWNrc3RhYigpDQogICAgYW50aWFpbV9mdW5jdGlvbnMubGVnaXRfYW50aWFpbShjbWQpDQogICAgYW50aWFpbV9mdW5jdGlvbnMuZnJlZXN0YW5kaW5nX3NldHVwKCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5tYW51YWxfYW50aWFpbSgpDQogICAgYW50aWFpbV9mdW5jdGlvbnMuZWRnZV95YXcoKQ0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJyb3VuZF9lbmQiLCBmdW5jdGlvbihjbWQpDQogICAgYW50aWFpbV9mdW5jdGlvbnMucm91bmRfZW5kID0gdHJ1ZQ0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJyb3VuZF9wcmVzdGFydCIsIGZ1bmN0aW9uKGNtZCkNCiAgICBhbnRpYWltX2Z1bmN0aW9ucy5yb3VuZF9lbmQgPSBmYWxzZQ0KZW5kKQ0KDQpjbGllbnQuc2V0X2V2ZW50X2NhbGxiYWNrKCJuZXRfdXBkYXRlX3N0YXJ0IiwgZnVuY3Rpb24oKQ0KICAgIGRlZmVuc2l2ZV9mdW5jdGlvbnMuX3J1bigpDQplbmQpDQoNCmNsaWVudC5zZXRfZXZlbnRfY2FsbGJhY2soInByZV9yZW5kZXIiLCBmdW5jdGlvbigpDQogICAgdmlzdWFsX2Z1bmN0aW9ucy5hbmltX2JyZWFrZXJzKCkNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnRfdWkiLCBmdW5jdGlvbigpDQogICAgdmlzdWFsX2Z1bmN0aW9ucy5yZW5kZXJfd2F0ZXJtYXJrKCkNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygicGFpbnQiLCBmdW5jdGlvbigpDQogICAgdmlzdWFsX2Z1bmN0aW9ucy5kYW1hZ2VfaW5kaWNhdG9yKCkNCmVuZCkNCg0KY2xpZW50LnNldF9ldmVudF9jYWxsYmFjaygic2h1dGRvd24iLCBmdW5jdGlvbigpDQogICAgdWkuc2V0KHJlZnMuZmFrZWxhZ19saW1pdCwgMTUpDQogICAgY2xpZW50LmV4ZWMoInN2X21heHVubGFnIDAuMiIpDQogICAgbHVhLmZ1bmNzLnJlc2V0X2FudGlhaW1fdGFiKHRydWUpDQogICAgbHVhLmZ1bmNzLmRlZmF1bHRfYW50aWFpbV90YWIoKQ0KZW5kKQ=="}
